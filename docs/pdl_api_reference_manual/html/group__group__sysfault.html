<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CAT2 Peripheral Driver Library: SysFault     (System Fault)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CAT2 Peripheral Driver Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__group__sysfault.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Modules</a>  </div>
  <div class="headertitle">
<div class="title">SysFault (System Fault)</div>  </div>
</div><!--header-->
<div class="contents">

<p>The SysFault driver provides an API to configure the Fault reporting structure.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:group__group__sysfault__macros"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__sysfault__macros.html">Macros</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__sysfault__enums"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__sysfault__enums.html">Enums</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__sysfault__data__structures"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__sysfault__data__structures.html">Data Structures</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__sysfault__functions"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__sysfault__functions.html">Functions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>The SysFault driver provides an API to configure the Fault reporting structure. </p>
<p>The functions and other declarations used in this driver are in cy_sysfault.h. You can include cy_pdl.h to get access to all functions and declarations in the PDL. This driver is only available for PSOC 4 HVMS 64/128K, PSOC 4 HVPA 144K, and PAG2S devices.</p>
<p>The fault subsystem contains information about faults that occur in the system. The fault subsystem captures only faults and does not take any action to correct them. The subsystem can cause a reset, give a pulse indication, or trigger another peripheral. HVMS 64/128K, PSOC 4 HVPA 144K, and PAG2S devices use a centralized fault report structure. The centralized nature allows for a system-wide consistent handling of faults, which simplifies software development. Only a single fault interrupt handler is required. The fault report structure provides the fault source and additional fault-specific information from a single set of memory mapped input/output (MMIO) registers, no iterative search is required for the fault source and fault information. All pending faults are available from a single set of MMIO registers. Below is the block diagram. </p><div class="image">
<img src="fault.png" alt="fault.png"/>
</div>
<p>The Fault IP provides a fault report structure. The fault report structures capture faults. The number of fault report structures is specified by the design time configuration parameter (FAULT_NR). In CAT2, there are two instances of fault structures, each fault report structure has a dedicated set of MMIO control and status registers and captures a single fault. The fault report structure provides fault source and additional fault specific information from a single set of MMIO registers. The fault structures capture faults like peripheral specific errors, memory controller specific errors. E.g., SRAM controller ECC errors, FLASH controller read during program and ECC errors, time out errors, power errors.</p>
<dl class="section note"><dt>Note</dt><dd>Note that some of the above faults also result in errors on the bus infrastructure.</dd></dl>
<p>System fault will be captured by fault report structures. A fault report structure provides the fault source and additional fault specific information from a single set of MMIO registers. The captured fault information includes:</p><ul>
<li>A validity bit field that indicates that a fault is captured.</li>
<li>A fault index that identifies the fault source.</li>
<li>Additional fault information that describes fault specifics</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>When a fault is configured to trigger a reset, the debugging of the configured fault structure is not possible.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>The ROM boot uses fault structure #0 (FAULT_STRUCT0) to detect potential fault sources during boot. It sets up fault masks to detect not correctable ECC errors for SRAM and flash. If fault report structure #0 is used to capture faults and is configured to trigger a reset, use the weak Cy_BootStatus() function and <a class="el" href="group__group__syslib__functions.html#ga85034b11b0d4af9c2b0f77f37837adaf">Cy_SysLib_GetBootStatus()</a> ~~should be used~~ to handle Boot-Up Status. Applicable to PSOC4 HVMS/PA only.</dd></dl>
<h1><a class="anchor" id="group_sysfault_configuration"></a>
Configuration Considerations</h1>
<p>Fault configuration includes the clearing of the existing fault status, enabling the fault source, setting an interrupt mask, and fault initialization. Below is the code snippet for the fault configuration. </p><div class="fragment"><div class="line"></div><div class="line">    <span class="comment">/* Scenario: Configures the SysFault for recording faults. */</span></div><div class="line"></div><div class="line">    <span class="comment">/* SysFault interrupt priority */</span></div><div class="line"><span class="preprocessor">    #define SYSFAULT_INTR_PRIORITY      (2UL)</span></div><div class="line"><span class="preprocessor">    #define SYSFAULT_INTR_NUM           ((IRQn_Type) cpuss_interrupt_fault_0_IRQn)</span></div><div class="line"></div><div class="line">    <span class="comment">/* SysFault config */</span></div><div class="line">    <a class="code" href="structcy__stc__sysfault__config__t.html">cy_stc_sysfault_config_t</a> sysfaultConfig =</div><div class="line">    {</div><div class="line">        .<a class="code" href="structcy__stc__sysfault__config__t.html#acc74dc02e07671608ab0421d16a74dbd">resetEnable</a>   = <span class="keyword">false</span>,</div><div class="line">        .outputEnable  = <span class="keyword">true</span>,</div><div class="line">        .triggerEnable = <span class="keyword">false</span>,</div><div class="line">    };</div><div class="line"></div><div class="line">    <span class="comment">/* Configure Interrupt for SysFault structure */</span></div><div class="line">    <a class="code" href="structcy__stc__sysint__t.html">cy_stc_sysint_t</a> sysfaultIntrConfig =</div><div class="line">    {</div><div class="line">        .<a class="code" href="structcy__stc__sysint__t.html#a6da08d81da65a7f93d3e4c46a4b8d950">intrSrc</a> = SYSFAULT_INTR_NUM,</div><div class="line">        .intrPriority = SYSFAULT_INTR_PRIORITY</div><div class="line">    };</div><div class="line"></div><div class="line">    <span class="comment">/*********************************************************************/</span></div><div class="line">    <span class="comment">/*****                 Fault report settings                     *****/</span></div><div class="line">    <span class="comment">/*********************************************************************/</span></div><div class="line">    <a class="code" href="group__group__sysfault__functions.html#ga6a87fe306c98073bb8a349e729a46a0b">Cy_SysFault_ClearStatus</a>(FAULT_STRUCT0); <span class="comment">// clear status</span></div><div class="line">    <a class="code" href="group__group__sysfault__functions.html#ga3757561d28a1c1bb728dc57d3c3f2e75">Cy_SysFault_SetMaskByIdx</a>(FAULT_STRUCT0, <a class="code" href="group__group__sysfault__enums.html#ggaecab0433ebc69ea2436086724f5d1e25ab0816958a47822d566d40ae7c6f325c6">SRSS_FAULT_CRWDT</a>); <span class="comment">// enable Fault CRWDT</span></div><div class="line">    <a class="code" href="group__group__sysfault__functions.html#ga9d781658d09b01527e3553805087dc01">Cy_SysFault_SetInterruptMask</a>(FAULT_STRUCT0);</div><div class="line">    <a class="code" href="group__group__sysfault__enums.html#ga5b38a4db7a96fcffc774203fed698452">cy_en_sysfault_status_t</a> status = <a class="code" href="group__group__sysfault__functions.html#gacb9d2c81308286f85cd133c287a95a2b">Cy_SysFault_Init</a>(FAULT_STRUCT0, &amp;sysfaultConfig);</div><div class="line"></div><div class="line">    <span class="comment">/*********************************************************************/</span></div><div class="line">    <span class="comment">/*****                   Interrupt settings                      *****/</span></div><div class="line">    <span class="comment">/*********************************************************************/</span></div><div class="line">    (void) <a class="code" href="group__group__sysint__functions.html#gab2ff6820a898e9af3f780000054eea5d">Cy_SysInt_Init</a>(&amp;sysfaultIntrConfig, &amp;irqFaultHandler);</div><div class="line">    NVIC_EnableIRQ(SYSFAULT_INTR_NUM);</div><div class="line"></div><div class="line">    <span class="comment">/* Triggers an interrupt via a software write.*/</span></div><div class="line">    <a class="code" href="group__group__sysfault__functions.html#ga3153ed4daa6e3c3ee1f54ae6c91d0484">Cy_SysFault_SetInterrupt</a>(FAULT_STRUCT0);</div><div class="line"></div></div><!-- fragment --><p> Once a configured fault occurs, the interrupt handler will be triggered where the fault information can be captured. Below is the code snippet, which can be part of the interrupt handler. </p><div class="fragment"><div class="line"></div><div class="line">    <span class="comment">/* Scenario: Handle the faults generated and get the fault data. */</span></div><div class="line"></div><div class="line">    <span class="comment">/* Returns the status of the interrupt for the fault structure */</span></div><div class="line">    uint32_t intrStatus = <a class="code" href="group__group__sysfault__functions.html#ga1f0b6880a7c3fc4fb5966fa46b3b5fec">Cy_SysFault_GetInterruptStatus</a>(FAULT_STRUCT0);</div><div class="line"></div><div class="line">    <span class="comment">/* Returns the interrupt mask. */</span></div><div class="line">    uint32_t intrMask = <a class="code" href="group__group__sysfault__functions.html#ga1aa43aa6d150c397082338fd6d3ed213">Cy_SysFault_GetInterruptMask</a>(FAULT_STRUCT0);</div><div class="line"></div><div class="line">    <span class="comment">/* Returns whether masked interrupt and triggered the interrupt are same. */</span></div><div class="line">    uint32_t intrMskdStatus = <a class="code" href="group__group__sysfault__functions.html#ga8fb0c91781ca571c5104573b6bd9bf41">Cy_SysFault_GetInterruptStatusMasked</a>(FAULT_STRUCT0);</div><div class="line"></div><div class="line">    <a class="code" href="group__group__sysfault__enums.html#gaecab0433ebc69ea2436086724f5d1e25">cy_en_sysfault_source_t</a> sysfaultSource = <a class="code" href="group__group__sysfault__functions.html#ga799b4991f8e8a2bc856f41bb89f4f350">Cy_SysFault_GetErrorSource</a>(FAULT_STRUCT0);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span>(sysfaultSource != CY_SYSFAULT_NO_FAULT)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span>(sysfaultSource == <a class="code" href="group__group__sysfault__enums.html#ggaecab0433ebc69ea2436086724f5d1e25ab0816958a47822d566d40ae7c6f325c6">SRSS_FAULT_CRWDT</a>) <span class="comment">// CRWDT Fault</span></div><div class="line">        {</div><div class="line">             <a class="code" href="group__group__sysfault__functions.html#ga4c9a9008d1bd16e289ea1b9e7a1f8739">Cy_SysFault_GetFaultData</a>(FAULT_STRUCT0, <a class="code" href="group__group__sysfault__enums.html#gga38adc53ca3a1e3ce4a1b7f8a739dced3a1515b67cfe882332b0ed2071283e6a37">CY_SYSFAULT_DATA0</a>); <span class="comment">// get fault data</span></div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/* Clears an interrupt mask.*/</span></div><div class="line">    <a class="code" href="group__group__sysfault__functions.html#ga5085c59a0e5a2f6da85e4de22a3e4399">Cy_SysFault_ClearInterruptMask</a>(FAULT_STRUCT0);</div><div class="line"></div><div class="line">    <span class="comment">/* Clear Interrupt flag */</span></div><div class="line">    <a class="code" href="group__group__sysfault__functions.html#ga0244e2749dc617b2252be69db0a4709f">Cy_SysFault_ClearInterrupt</a>(FAULT_STRUCT0);</div><div class="line"></div></div><!-- fragment --> <h1><a class="anchor" id="group_sysfault_section_more_information"></a>
More Information</h1>
<p>For more information on the System Fault, refer to the technical reference manual (TRM).</p>
<h1><a class="anchor" id="group_sysfault_changelog"></a>
Changelog</h1>
<table class="doxtable">
<tr>
<th>Version</th><th>Changes</th><th>Reason for Change </th></tr>
<tr>
<td>1.10 </td><td>Added the <a class="el" href="group__group__sysfault__functions.html#gaeb06169f3c70b3fc66c12f5e1c3e79c0">Cy_SysFault_SetFaultSource</a> and <a class="el" href="group__group__sysfault__functions.html#ga7c804ede58f9f0fd8e337392930e1a2e">Cy_SysFault_SetFaultData</a> functions. </td><td>API improvement.  </td></tr>
<tr>
<td>1.0 </td><td>Initial version </td><td></td></tr>
</table>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>CAT2 Peripheral Driver Library</b> by <b>Infineon Technologies</b>.
            All rights reserved.
        </li>
    </ul>
</div>
-->
</body>
</html>
