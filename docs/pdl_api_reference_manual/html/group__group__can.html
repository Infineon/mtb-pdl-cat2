<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CAT2 Peripheral Driver Library: CAN          (Controller Area Network)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CAT2 Peripheral Driver Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__group__can.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Modules</a>  </div>
  <div class="headertitle">
<div class="title">CAN (Controller Area Network)</div>  </div>
</div><!--header-->
<div class="contents">

<p>The CAN driver provides an easy method to access the CAN IP block registers and provides simple functionality for sending and receiving data between devices in the CAN network.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:group__group__can__macros"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__can__macros.html">Macros</a></td></tr>
<tr class="memdesc:group__group__can__macros"><td class="mdescLeft">&#160;</td><td class="mdescRight">This section describes the CAN Macros. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__can__functions"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__can__functions.html">Functions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__can__data__structures"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__can__data__structures.html">Data Structures</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__can__enums"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__can__enums.html">Enumerated Types</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>The CAN driver provides an easy method to access the CAN IP block registers and provides simple functionality for sending and receiving data between devices in the CAN network. </p>
<p>The CAN driver provides an API to configure the main features - bit time, message buffers - and transmit and receive the CAN message. The CAN driver is not compatible with CAN FD or future versions.</p>
<div class="image">
<img src="can_solution.png" alt="can_solution.png" width="948px"/>
<div class="caption">
CAN Solution</div></div>
 <h1><a class="anchor" id="group_can_section_configuration"></a>
Configuration Considerations</h1>
<p>Specification of the sample code is as follows:</p><ul>
<li>Configurable CAN clock</li>
<li>Configurable CAN Bit rate</li>
<li>Rx buffer configuration</li>
<li>H/W feature configuration such as test mode and byte endianness</li>
<li>Interrupts : <br />
 CY_CAN_TRANSMISSION_COMPLETE (Message sent from Tx buffer) <br />
 CY_CAN_RX_BUFFER_NEW_MESSAGE (Message stored to Rx buffer). <br />
 Sends data of ID:0x200 periodically in the main(). Echobacks received data by incrementing the ID of the received packet in the receiving interrupt.(<a class="el" href="group__group__can__functions.html#gaa813c4451617c546218bf8f98c1d505e" title="CAN (Status/Error/Rx/Tx) interrupt ISR. ">Cy_CAN_IrqHandler()</a> &mdash; CanCallbackRx())</li>
</ul>
<h2><a class="anchor" id="group_can_section_configuration_personalities"></a>
Use ModusToolbox Device Configurator Tool to generate initialization code</h2>
<p>The steps to generate initialization code using the ModusToolbox Device Configurator Tool:</p>
<ol type="1">
<li>Launch the ModusToolbox Device Configurator Tool.</li>
<li>Switch to the Peripherals tab. Enable the CAN channel personality under Communication and enter Alias (default is can_0).</li>
<li>Go to the Parameters Pane for the CAN Personality and configure it with the desired parameters (set the Clock Signal divider, set the bit timing configuration, set the other parameters per Configuration Considerations, etc).</li>
<li>Perform File-&gt;Save for the initialization code to generate.</li>
</ol>
<p>Now, all required CAN initialization code and configuration prerequisites will be generated:</p>
<ul>
<li>The Peripheral Clock Divider assignment and analog routing are parts of the init_cycfg_all() routine. Place the call of the init_cycfg_all() function before using any CAN API functions to ensure initialization of all external resources required for the CAN operation.</li>
<li>The CAN configuration structure declaration is in the cycfg_peripherals.h file and its initialization is in the cycfg_peripherals.c file. The variable name is &lt;CAN_Alias_Name&gt;_config (default is can_0_config). It must be used with <a class="el" href="group__group__can__functions.html#gaf2ef1b950d10575ced951c3487c2087a">Cy_CAN_Init()</a> function.</li>
<li>Tx Buffers are not initialized. They are set when you send a message.</li>
</ul>
<p>For the CAN interrupt service routine, <a class="el" href="group__group__can__functions.html#gaa813c4451617c546218bf8f98c1d505e">Cy_CAN_IrqHandler()</a> can be used. It handles reading data from Rx buffers. Corresponding callback functions are called for error interrupts, Rx interrupts and Tx complete interrupt. Put the names of callback functions to the Callback functions parameters section. Put NULL if no callback function to be used. </p><dl class="section note"><dt>Note</dt><dd>Only Tx and Rx interrupt sources are enabled by default. Use <a class="el" href="group__group__can__functions.html#ga821397ce2b0a8940c423099000c35f8b">Cy_CAN_SetInterruptMask()</a> to enable other interrupt sources. </dd>
<dd>
Interrupt flags are set regardless of the interrupt enable register. Cy_CAN_IrqHandler will check and process all supported interrupts when triggered with any enabled interrupt source.</dd></dl>
<div class="fragment"><div class="line"><span class="comment">/* CAN interrupt handler */</span></div><div class="line"><span class="keywordtype">void</span> CAN_InterruptHandler(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">/* Just call the IRQ handler with the context */</span></div><div class="line">    <a class="code" href="group__group__can__functions.html#gaa813c4451617c546218bf8f98c1d505e">Cy_CAN_IrqHandler</a>(CAN, &amp;context);</div><div class="line">}</div></div><!-- fragment --><p> Set up the interrupt handler to be called with CAN events. The following code shows how to set up the interrupt handler: </p><div class="fragment"><div class="line">    <span class="comment">/* Setup the CAN interrupt */</span></div><div class="line">    {</div><div class="line">        <span class="comment">/* Populate the configuration structure */</span></div><div class="line">        <span class="keyword">const</span> <a class="code" href="structcy__stc__sysint__t.html">cy_stc_sysint_t</a> irq_cfg =</div><div class="line">        {</div><div class="line">            <span class="comment">/* .intrSrc */</span> can_interrupt_can_IRQn, <span class="comment">/* CAN interrupt number */</span></div><div class="line">            <span class="comment">/* .intrPriority */</span> 3UL</div><div class="line">        };</div><div class="line">        <span class="comment">/* Hook the interrupt service routine and enable the interrupt */</span></div><div class="line">        (void) <a class="code" href="group__group__sysint__functions.html#gab2ff6820a898e9af3f780000054eea5d">Cy_SysInt_Init</a>(&amp;irq_cfg, &amp;CAN_InterruptHandler);</div><div class="line">        NVIC_EnableIRQ(can_interrupt_can_IRQn);</div><div class="line">    }</div></div><!-- fragment --> <h2><a class="anchor" id="group_can_section_configuration_manual"></a>
Implement the initialization code manually</h2>
<p>Call <a class="el" href="group__group__can__functions.html#gaf2ef1b950d10575ced951c3487c2087a" title="Initializes the CAN module. ">Cy_CAN_Init()</a> to initialize the CAN module. It initializes the CAN module with the configuration parameters, passed in the <a class="el" href="structcy__stc__can__config__t.html">cy_stc_can_config_t</a> structure. It consists of several elements to be defined first. </p><div class="fragment"><div class="line"></div><div class="line">    <span class="keyword">const</span> <a class="code" href="structcy__stc__can__config__t.html">cy_stc_can_config_t</a> canConfig =</div><div class="line">    {</div><div class="line">        <span class="comment">/* .txCallback          */</span> NULL,</div><div class="line">        <span class="comment">/* .rxCallback          */</span> CAN_RxMsgCallback,</div><div class="line">        <span class="comment">/* .errorCallback       */</span> NULL,</div><div class="line">        <span class="comment">/* .arbiter             */</span> <a class="code" href="group__group__can__enums.html#ggafd43b28eb2dfde61f163fedcc8402d3ea0351e9d8f3054011d9e64268003ea5be">CY_CAN_FIXED_PRIORITY</a>,</div><div class="line">        <span class="comment">/* .swapEndian          */</span> <a class="code" href="group__group__can__enums.html#gga94775a60d0545fa261bcaa6dc1a040baa597f4bf2dc8e0e55e24f034a33ab46fe">CY_CAN_LITTLE_ENDIAN</a>,</div><div class="line">        <span class="comment">/* .busOffRestart       */</span> <a class="code" href="group__group__can__enums.html#ggaac868830ab0411acfeb3f79a5eb7194aa0856683515d53f3008946bc231c2d06c">CY_CAN_MANUAL</a>,</div><div class="line">        <span class="comment">/* .bitrate             */</span> &amp;bitrateConfig,</div><div class="line">        <span class="comment">/* .rxBuffer            */</span> &amp;(rxbConfig[0]),</div><div class="line">        <span class="comment">/* .numOfRxBuffers      */</span> 4u</div><div class="line">    };</div></div><!-- fragment --><p>The <a class="el" href="group__group__can__functions.html#gaf2ef1b950d10575ced951c3487c2087a" title="Initializes the CAN module. ">Cy_CAN_Init()</a> function also initializes the shared context structure used later with other API functions. </p><div class="fragment"><div class="line"><a class="code" href="structcy__stc__can__context__t.html">cy_stc_can_context_t</a> context;   <span class="comment">/* This is a shared context structure,</span></div><div class="line"><span class="comment">                                 * unique for each channel</span></div><div class="line"><span class="comment">                                 */</span></div></div><!-- fragment --><p>Although the callback functions are optional, they are recommended for use, otherwise, there is no report to the API about any error and transmission or reception events. The example callback function sends received data back to the bus, incrementing ID by 1: </p><div class="fragment"><div class="line"><span class="comment">/* CAN reception callback */</span></div><div class="line"><span class="keywordtype">void</span> CAN_RxMsgCallback(uint8_t index,</div><div class="line">                       <a class="code" href="structcy__stc__can__message__frame__t.html">cy_stc_can_message_frame_t</a>* rxMsg)</div><div class="line">{</div><div class="line">    CY_UNUSED_PARAMETER(index);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (!rxMsg-&gt;<a class="code" href="structcy__stc__can__message__frame__t.html#ac0bcf1c2eff179eb6057e22a11313e48">rtr</a>) <span class="comment">/* Only for data frames */</span></div><div class="line">    {</div><div class="line">        <span class="comment">/* Sends the same message back with an incremented ID */</span></div><div class="line">        <a class="code" href="structcy__stc__can__message__frame__t.html">cy_stc_can_message_frame_t</a> txMsg = *rxMsg;</div><div class="line">        txMsg.<a class="code" href="structcy__stc__can__message__frame__t.html#a077ce5e7245b8e2aef56c834e5c78441">id</a> += 1u;</div><div class="line"></div><div class="line">        <a class="code" href="group__group__can__functions.html#ga723736066b1f48b7ad239af811221d2e">Cy_CAN_Transmit</a>(CAN, 0u, &amp;txMsg, <span class="keyword">true</span>, <span class="keyword">false</span>, &amp;context);</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p>The CAN block uses the Port 4 or 6 pins for receive (P4[0],P6[1]) and transmit (P4[1],P6[2]).</p><ul>
<li>Connect the specified High-Speed Input Output Multiplexer (HSIOM) selection to the pin.</li>
<li>Set the pins drive mode for RX and TX.</li>
</ul>
<div class="fragment"><div class="line">    <span class="comment">/* Assign pins for CAN Rx and Tx: P6[1] and P6[2]. */</span></div><div class="line"><span class="preprocessor">    #define CAN_PORT    (P6_0_PORT)</span></div><div class="line"><span class="preprocessor">    #define CAN_RX_NUM  (P6_1_NUM)</span></div><div class="line"><span class="preprocessor">    #define CAN_TX_NUM  (P6_2_NUM)</span></div><div class="line"></div><div class="line">    <a class="code" href="group__group__gpio__functions__init.html#gab9eb13a6056e4c824514d59ce66017b5">Cy_GPIO_SetHSIOM</a>(CAN_PORT, CAN_RX_NUM, P6_1_CAN_CAN_RX);</div><div class="line">    <a class="code" href="group__group__gpio__functions__init.html#gab9eb13a6056e4c824514d59ce66017b5">Cy_GPIO_SetHSIOM</a>(CAN_PORT, CAN_TX_NUM, P6_2_CAN_CAN_TX);</div><div class="line"></div><div class="line">    <a class="code" href="group__group__gpio__functions__gpio.html#ga97e64dc8c45e7cd73e3012100d03b1fd">Cy_GPIO_SetDrivemode</a>(CAN_PORT, CAN_RX_NUM, <a class="code" href="group__group__gpio__drive_modes.html#gaf2fe5dc00ba1770b37e620a01169485c">CY_GPIO_DM_HIGHZ</a>);</div><div class="line">    <a class="code" href="group__group__gpio__functions__gpio.html#ga97e64dc8c45e7cd73e3012100d03b1fd">Cy_GPIO_SetDrivemode</a>(CAN_PORT, CAN_TX_NUM, <a class="code" href="group__group__gpio__drive_modes.html#ga9e554ee7c43ac65a6d48274455b53823">CY_GPIO_DM_STRONG</a>);</div></div><!-- fragment --><p> For the CAN interrupt service routine, the <a class="el" href="group__group__can__functions.html#gaa813c4451617c546218bf8f98c1d505e" title="CAN (Status/Error/Rx/Tx) interrupt ISR. ">Cy_CAN_IrqHandler()</a> can be used. It handles reading data from Rx buffers. Corresponding callback functions are called for error interrupts, Rx interrupts and Tx complete interrupt. </p><dl class="section note"><dt>Note</dt><dd>Only Tx and Rx interrupt sources are enabled by default. Use <a class="el" href="group__group__can__functions.html#ga821397ce2b0a8940c423099000c35f8b">Cy_CAN_SetInterruptMask()</a> to enable other interrupt sources. </dd>
<dd>
Interrupt flags are set regardless of the interrupt enable register. Cy_CAN_IrqHandler will check and process all supported interrupts when triggered with any enabled interrupt source.</dd></dl>
<div class="fragment"><div class="line"><span class="comment">/* CAN interrupt handler */</span></div><div class="line"><span class="keywordtype">void</span> CAN_InterruptHandler(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">/* Just call the IRQ handler with the context */</span></div><div class="line">    <a class="code" href="group__group__can__functions.html#gaa813c4451617c546218bf8f98c1d505e">Cy_CAN_IrqHandler</a>(CAN, &amp;context);</div><div class="line">}</div></div><!-- fragment --><p> Setup the interrupt handler to be called with the CAN events. The following code shows how to set up the interrupt handler: </p><div class="fragment"><div class="line">    <span class="comment">/* Setup the CAN interrupt */</span></div><div class="line">    {</div><div class="line">        <span class="comment">/* Populate the configuration structure */</span></div><div class="line">        <span class="keyword">const</span> <a class="code" href="structcy__stc__sysint__t.html">cy_stc_sysint_t</a> irq_cfg =</div><div class="line">        {</div><div class="line">            <span class="comment">/* .intrSrc */</span> can_interrupt_can_IRQn, <span class="comment">/* CAN interrupt number */</span></div><div class="line">            <span class="comment">/* .intrPriority */</span> 3UL</div><div class="line">        };</div><div class="line">        <span class="comment">/* Hook the interrupt service routine and enable the interrupt */</span></div><div class="line">        (void) <a class="code" href="group__group__sysint__functions.html#gab2ff6820a898e9af3f780000054eea5d">Cy_SysInt_Init</a>(&amp;irq_cfg, &amp;CAN_InterruptHandler);</div><div class="line">        NVIC_EnableIRQ(can_interrupt_can_IRQn);</div><div class="line">    }</div></div><!-- fragment --><p> The CAN has a bit rate setting. It consists of a pre-scaler, time segment 1, time segment 2 and synchronization jump width. </p><dl class="section note"><dt>Note</dt><dd>The actual interpretation by the hardware of configured values is one more value than programmed.</dd></dl>
<p>The CAN time quantum (tq) may be programmed in the range of 1 to 32768 CAN clock periods: tq = (prescaler + 1) * Tsys, where Tsys is <a class="el" href="group__group__sysclk__clk__sys.html">System Clock</a> clock period. The length of the bit time is (programmed values) [timeSegment1 + timeSegment2 + 3] tq. The example below shows the configuration with the 250 kbps bit rate. This assumes the SYSCLK frequency of 48 MHz for the CAN block. </p><div class="fragment"><div class="line"></div><div class="line">    <span class="keyword">const</span> <a class="code" href="structcy__stc__can__bitrate__t.html">cy_stc_can_bitrate_t</a> bitrateConfig =</div><div class="line">    {</div><div class="line">        <span class="comment">/* .prescaler       */</span> 12u - 1u, <span class="comment">/* can_clk = 48MHz / 12 = 4MHz</span></div><div class="line"><span class="comment">                                          * CAN baudrate = can_clk / bit-time</span></div><div class="line"><span class="comment">                                          *  = 4MHz / 16TQ = 250Kbps */</span></div><div class="line">        <span class="comment">/* .timeSegment1    */</span> 10u - 1u,</div><div class="line">        <span class="comment">/* .timeSegment2    */</span> 5u - 1u,</div><div class="line">        <span class="comment">/* .syncJumpWidth   */</span> 2u - 1u,</div><div class="line">        <span class="comment">/* .samplingMode    */</span> <a class="code" href="group__group__can__enums.html#ggab4c2c7a4fe96499105914fd1cd32b5e4a3c8baa2604dee2b954977e6324a61b0a">CY_CAN_SAMPLING_MODE_1</a>,</div><div class="line">        <span class="comment">/* .edgeMode        */</span> <a class="code" href="group__group__can__enums.html#ggaca2f2d02d6cf608e9d2aafb6b792191aa9ef6a844be025abd70940cb3c1be7ed8">CY_CAN_EDGE_R_TO_D</a></div><div class="line">    };</div></div><!-- fragment --><p>CAN driver provides API to setup Message ID filtering. One filter can be set for one Rx buffer. The desired count of the filters(buffers) is specified in the <a class="el" href="structcy__stc__can__config__t.html">cy_stc_can_config_t</a> structure and is set once during block initialization. It is possible to change the configured filter setting with <a class="el" href="group__group__can__functions.html#gae886134e4a73f4057e86995b063f57fb">Cy_CAN_UpdateRxBufferConfig()</a>. </p><div class="fragment"><div class="line"></div><div class="line"><span class="preprocessor">    #define MESSAGE_ID0          (0x00000010UL)</span></div><div class="line"><span class="preprocessor">    #define MESSAGE_ID1          (0x00000020UL)</span></div><div class="line"><span class="preprocessor">    #define MESSAGE_ID1_MASK     (0x0000002FUL)</span></div><div class="line"><span class="preprocessor">    #define MESSAGE_ID2          (0x00010010UL)</span></div><div class="line"><span class="preprocessor">    #define MESSAGE_ID3          (0x00010020UL)</span></div><div class="line"><span class="preprocessor">    #define MESSAGE_ID3_MASK     (0x0001002FUL)</span></div><div class="line"></div><div class="line">    <span class="keyword">const</span> <a class="code" href="structcy__stc__can__rx__buffer__config__t.html">cy_stc_can_rx_buffer_config_t</a> rxbConfig[4] =</div><div class="line">    {</div><div class="line">        {</div><div class="line">            <span class="comment">/* .acceptanceMask      */</span> {</div><div class="line">                <span class="comment">/* .id      */</span> 0u, <span class="comment">/* No mask bits. Receive only the Code ID */</span></div><div class="line">                <span class="comment">/* .idType  */</span> <a class="code" href="group__group__can__enums.html#ggac2bce989dc8f2941c3a7956c7d8b84eda8175c0bf39c76d46ca1ce4f16008b2df">CY_CAN_IDE_STANDARD_ID</a>,</div><div class="line">                <span class="comment">/* .data    */</span> 0xFFFFu,</div><div class="line">                <span class="comment">/* .rtr     */</span> 0u,</div><div class="line">                <span class="comment">/* .ide     */</span> 0u</div><div class="line">            },</div><div class="line">            <span class="comment">/* .acceptanceCode      */</span> {</div><div class="line">                <span class="comment">/* .id      */</span> MESSAGE_ID0,</div><div class="line">                <span class="comment">/* .idType  */</span> <a class="code" href="group__group__can__enums.html#ggac2bce989dc8f2941c3a7956c7d8b84eda8175c0bf39c76d46ca1ce4f16008b2df">CY_CAN_IDE_STANDARD_ID</a>,</div><div class="line">                <span class="comment">/* .data    */</span> 0xFFFFu,</div><div class="line">                <span class="comment">/* .rtr     */</span> 0u,</div><div class="line">                <span class="comment">/* .ide     */</span> 0u</div><div class="line">            },</div><div class="line">            <span class="comment">/* .linked              */</span> <span class="keyword">false</span>,</div><div class="line">            <span class="comment">/* .interruptEnabled    */</span> <span class="keyword">true</span>,</div><div class="line">            <span class="comment">/* .autoReplyRtr        */</span> <span class="keyword">false</span>,</div><div class="line">            <span class="comment">/* .enable              */</span> <span class="keyword">true</span></div><div class="line">        },</div><div class="line">        {</div><div class="line">            <span class="comment">/* .acceptanceMask      */</span> {</div><div class="line">                <span class="comment">/* .id      */</span> MESSAGE_ID1_MASK,</div><div class="line">                <span class="comment">/* .idType  */</span> <a class="code" href="group__group__can__enums.html#ggac2bce989dc8f2941c3a7956c7d8b84eda8175c0bf39c76d46ca1ce4f16008b2df">CY_CAN_IDE_STANDARD_ID</a>,</div><div class="line">                <span class="comment">/* .data    */</span> 0xFFFFu,</div><div class="line">                <span class="comment">/* .rtr     */</span> 0u,</div><div class="line">                <span class="comment">/* .ide     */</span> 0u</div><div class="line">            },</div><div class="line">            <span class="comment">/* .acceptanceCode      */</span> {</div><div class="line">                <span class="comment">/* .id      */</span> MESSAGE_ID1,</div><div class="line">                <span class="comment">/* .idType  */</span> <a class="code" href="group__group__can__enums.html#ggac2bce989dc8f2941c3a7956c7d8b84eda8175c0bf39c76d46ca1ce4f16008b2df">CY_CAN_IDE_STANDARD_ID</a>,</div><div class="line">                <span class="comment">/* .data    */</span> 0xFFFFu,</div><div class="line">                <span class="comment">/* .rtr     */</span> 0u,</div><div class="line">                <span class="comment">/* .ide     */</span> 0u</div><div class="line">            },</div><div class="line">            <span class="comment">/* .linked              */</span> <span class="keyword">false</span>,</div><div class="line">            <span class="comment">/* .interruptEnabled    */</span> <span class="keyword">true</span>,</div><div class="line">            <span class="comment">/* .autoReplyRtr        */</span> <span class="keyword">false</span>,</div><div class="line">            <span class="comment">/* .enable              */</span> <span class="keyword">true</span></div><div class="line">        },</div><div class="line">        {</div><div class="line">            <span class="comment">/* .acceptanceMask      */</span> {</div><div class="line">                <span class="comment">/* .id      */</span> 0u, <span class="comment">/* No mask bits. Receive only the Code ID */</span></div><div class="line">                <span class="comment">/* .idType  */</span> <a class="code" href="group__group__can__enums.html#ggac2bce989dc8f2941c3a7956c7d8b84eda8cfc1f2ccf339c987cf7f3f411955bd1">CY_CAN_IDE_EXTENDED_ID</a>,</div><div class="line">                <span class="comment">/* .data    */</span> 0xFFFFu,</div><div class="line">                <span class="comment">/* .rtr     */</span> 0u,</div><div class="line">                <span class="comment">/* .ide     */</span> 0u</div><div class="line">            },</div><div class="line">            <span class="comment">/* .acceptanceCode      */</span> {</div><div class="line">                <span class="comment">/* .id      */</span> MESSAGE_ID2,</div><div class="line">                <span class="comment">/* .idType  */</span> <a class="code" href="group__group__can__enums.html#ggac2bce989dc8f2941c3a7956c7d8b84eda8cfc1f2ccf339c987cf7f3f411955bd1">CY_CAN_IDE_EXTENDED_ID</a>,</div><div class="line">                <span class="comment">/* .data    */</span> 0xFFFFu,</div><div class="line">                <span class="comment">/* .rtr     */</span> 0u,</div><div class="line">                <span class="comment">/* .ide     */</span> 1u</div><div class="line">            },</div><div class="line">            <span class="comment">/* .linked              */</span> <span class="keyword">false</span>,</div><div class="line">            <span class="comment">/* .interruptEnabled    */</span> <span class="keyword">true</span>,</div><div class="line">            <span class="comment">/* .autoReplyRtr        */</span> <span class="keyword">false</span>,</div><div class="line">            <span class="comment">/* .enable              */</span> <span class="keyword">true</span></div><div class="line">        },</div><div class="line">        {</div><div class="line">            <span class="comment">/* .acceptanceMask      */</span> {</div><div class="line">                <span class="comment">/* .id      */</span> MESSAGE_ID3_MASK,</div><div class="line">                <span class="comment">/* .idType  */</span> <a class="code" href="group__group__can__enums.html#ggac2bce989dc8f2941c3a7956c7d8b84eda8cfc1f2ccf339c987cf7f3f411955bd1">CY_CAN_IDE_EXTENDED_ID</a>,</div><div class="line">                <span class="comment">/* .data    */</span> 0xFFFFu,</div><div class="line">                <span class="comment">/* .rtr     */</span> 0u,</div><div class="line">                <span class="comment">/* .ide     */</span> 0u</div><div class="line">            },</div><div class="line">            <span class="comment">/* .acceptanceCode      */</span> {</div><div class="line">                <span class="comment">/* .id      */</span> MESSAGE_ID3,</div><div class="line">                <span class="comment">/* .idType  */</span> <a class="code" href="group__group__can__enums.html#ggac2bce989dc8f2941c3a7956c7d8b84eda8cfc1f2ccf339c987cf7f3f411955bd1">CY_CAN_IDE_EXTENDED_ID</a>,</div><div class="line">                <span class="comment">/* .data    */</span> 0xFFFFu,</div><div class="line">                <span class="comment">/* .rtr     */</span> 0u,</div><div class="line">                <span class="comment">/* .ide     */</span> 1u</div><div class="line">            },</div><div class="line">            <span class="comment">/* .linked              */</span> <span class="keyword">false</span>,</div><div class="line">            <span class="comment">/* .interruptEnabled    */</span> <span class="keyword">true</span>,</div><div class="line">            <span class="comment">/* .autoReplyRtr        */</span> <span class="keyword">false</span>,</div><div class="line">            <span class="comment">/* .enable              */</span> <span class="keyword">true</span></div><div class="line">        }</div><div class="line">    };</div></div><!-- fragment --><p>The <a class="el" href="structcy__stc__can__config__t.html" title="CAN configuration. ">cy_stc_can_config_t</a> structure is used to pass all configuration to <a class="el" href="group__group__can__functions.html#gaf2ef1b950d10575ced951c3487c2087a" title="Initializes the CAN module. ">Cy_CAN_Init()</a> function. It is populated with pointers to other structures required and constants, defined before. </p><div class="fragment"><div class="line"></div><div class="line">    <span class="keyword">const</span> <a class="code" href="structcy__stc__can__config__t.html">cy_stc_can_config_t</a> canConfig =</div><div class="line">    {</div><div class="line">        <span class="comment">/* .txCallback          */</span> NULL,</div><div class="line">        <span class="comment">/* .rxCallback          */</span> CAN_RxMsgCallback,</div><div class="line">        <span class="comment">/* .errorCallback       */</span> NULL,</div><div class="line">        <span class="comment">/* .arbiter             */</span> <a class="code" href="group__group__can__enums.html#ggafd43b28eb2dfde61f163fedcc8402d3ea0351e9d8f3054011d9e64268003ea5be">CY_CAN_FIXED_PRIORITY</a>,</div><div class="line">        <span class="comment">/* .swapEndian          */</span> <a class="code" href="group__group__can__enums.html#gga94775a60d0545fa261bcaa6dc1a040baa597f4bf2dc8e0e55e24f034a33ab46fe">CY_CAN_LITTLE_ENDIAN</a>,</div><div class="line">        <span class="comment">/* .busOffRestart       */</span> <a class="code" href="group__group__can__enums.html#ggaac868830ab0411acfeb3f79a5eb7194aa0856683515d53f3008946bc231c2d06c">CY_CAN_MANUAL</a>,</div><div class="line">        <span class="comment">/* .bitrate             */</span> &amp;bitrateConfig,</div><div class="line">        <span class="comment">/* .rxBuffer            */</span> &amp;(rxbConfig[0]),</div><div class="line">        <span class="comment">/* .numOfRxBuffers      */</span> 4u</div><div class="line">    };</div></div><!-- fragment --><p>The <a class="el" href="group__group__can__functions.html#gaf2ef1b950d10575ced951c3487c2087a" title="Initializes the CAN module. ">Cy_CAN_Init()</a> function initializes the CAN block by writing CAN configuration registers. <a class="el" href="group__group__can__functions.html#gaf2ef1b950d10575ced951c3487c2087a" title="Initializes the CAN module. ">Cy_CAN_Init()</a> enables the Rx interrupts for new message reception into the Rx buffers. <a class="el" href="group__group__can__functions.html#gaf2ef1b950d10575ced951c3487c2087a" title="Initializes the CAN module. ">Cy_CAN_Init()</a> also enables the Tx interrupts for the Tx buffers successful transmission. The code example also shows the test mode configuration which can be used to enable the internal loopback mode. See <a class="el" href="group__group__can__enums.html#gab79b96b04361b35ff2ab4cf0cff71b1b">cy_en_can_test_mode_t</a> for details. <a class="el" href="group__group__can__functions.html#gaf2ef1b950d10575ced951c3487c2087a" title="Initializes the CAN module. ">Cy_CAN_Init()</a> sets test mode configuration to CY_CAN_TEST_MODE_DISABLE. Remember to disable the echo functionality in the Rx callback when using a loopback. </p><div class="fragment"><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__group__can__enums.html#gga487cbc7e67c181bd6668fac32026a1eaa67e7fcf7ffd416753a0e5ec189a129e4">CY_CAN_SUCCESS</a> != <a class="code" href="group__group__can__functions.html#gaf2ef1b950d10575ced951c3487c2087a">Cy_CAN_Init</a> (CAN, &amp;canConfig, &amp;context))</div><div class="line">    {</div><div class="line">        <span class="comment">/* Error processing */</span></div><div class="line">    }</div><div class="line">    <span class="comment">/* after initialization CAN started */</span></div><div class="line">    <a class="code" href="group__group__can__functions.html#ga9531325e51e1c9123889a43d8a5c3916">Cy_CAN_Stop</a>(CAN);</div><div class="line">    <span class="comment">/* Sets the Test mode configuration */</span></div><div class="line">    <a class="code" href="group__group__can__functions.html#ga8c624d991e4d69920152e90c34897e20">Cy_CAN_SetTestMode</a>(CAN, <a class="code" href="group__group__can__enums.html#ggab79b96b04361b35ff2ab4cf0cff71b1ba636e8fd74f760587665b255f1be2336f">CY_CAN_TEST_MODE_INTERNAL_LOOP_BACK</a>);</div><div class="line">    <span class="comment">/* Sets the CAN controller to start mode */</span></div><div class="line">    <a class="code" href="group__group__can__functions.html#ga3aa50166a42a754e237df22c026364e8">Cy_CAN_Start</a>(CAN);</div></div><!-- fragment --><p>To send a CAN message, a message structure must be prepared which consists of the CAN ID , data and data length. </p><div class="fragment"><div class="line">    <span class="comment">/* Prepares a CAN message to transmit */</span></div><div class="line"></div><div class="line">    <a class="code" href="structcy__stc__can__message__frame__t.html">cy_stc_can_message_frame_t</a> txMsg =</div><div class="line">    {</div><div class="line">        <span class="comment">/* .id */</span>       0x00000055UL,</div><div class="line">        <span class="comment">/* .data */</span>     { 0x44332211, 0x88776655 },</div><div class="line">        <span class="comment">/* .length */</span>   8u,</div><div class="line">        <span class="comment">/* .rtr */</span>      <span class="keyword">false</span>,</div><div class="line">        <span class="comment">/* .ide */</span>      <span class="keyword">false</span></div><div class="line">    };</div></div><!-- fragment --><p>To transmit CAN messages, the function <a class="el" href="group__group__can__functions.html#ga723736066b1f48b7ad239af811221d2e">Cy_CAN_Transmit()</a> is used. The buffer status can be retrieved by <a class="el" href="group__group__can__functions.html#ga75b85c87e218395257a3de2b4cb57539">Cy_CAN_GetTxBufferStatus()</a>. It is possible to set a callback function which will be notified whenever a message transmission has been completed. </p><div class="fragment"><div class="line">    <span class="comment">/* Checks that the Tx buffer to use is idle */</span></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__group__can__enums.html#gga890be85960c3b322fa43b0a17530dc6dad9f514edb2aac3e7135c069cdf968145">CY_CAN_TX_BUFFER_IDLE</a> == <a class="code" href="group__group__can__functions.html#ga75b85c87e218395257a3de2b4cb57539">Cy_CAN_GetTxBufferStatus</a>(CAN, 0U))</div><div class="line">    {</div><div class="line">        <span class="comment">/* Sends the prepared data using Tx buffer #0 */</span></div><div class="line">        <a class="code" href="group__group__can__functions.html#ga723736066b1f48b7ad239af811221d2e">Cy_CAN_Transmit</a>(CAN, 0u, &amp;txMsg, <span class="keyword">false</span>, <span class="keyword">false</span>, &amp;context);</div><div class="line">    }</div><div class="line">    <a class="code" href="group__group__syslib__functions.html#gaad1c32546fdb0e3c6fa8b46fb95843b5">Cy_SysLib_Delay</a>(1000u);</div></div><!-- fragment --> <h1><a class="anchor" id="group_can_section_more_information"></a>
More Information</h1>
<p>For more information on the CAN peripheral, refer to the technical reference manual (TRM).</p>
<h1><a class="anchor" id="group_can_changelog"></a>
Changelog</h1>
<table class="doxtable">
<tr>
<th>Version</th><th>Changes</th><th>Reason for Change </th></tr>
<tr>
<td>1.0 </td><td>Initial version </td><td></td></tr>
</table>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>CAT2 Peripheral Driver Library</b> by <b>Infineon Technologies</b>.
            All rights reserved.
        </li>
    </ul>
</div>
-->
</body>
</html>
