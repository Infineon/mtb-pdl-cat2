<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CAT2 Peripheral Driver Library: WDC          (Watchdog Counters)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CAT2 Peripheral Driver Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__group__wdc.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">API Reference</a>  </div>
  <div class="headertitle">
<div class="title">WDC (Watchdog Counters)</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">General Description</h2>
<p>Watchdog Counters (WDC) are general-purpose timers clocked from a low- frequency clock source and capable of generating interrupts. </p>
<p>Features:</p><ul>
<li>Two 16-bit and one 32-bit counters</li>
<li>Can be configured to generate periodic interrupts</li>
<li>Can be clocked from ILO or WCO</li>
<li>Counters can be cascaded to achieve a bigger period</li>
<li>Can work in Sleep and Deep Sleep power modes</li>
</ul>
<p>The functions and other declarations used in this driver are in cy_wdc.h. You can include cy_pdl.h to get access to all functions and declarations in the PDL.</p>
<p>There are two primary use cases for WDC: generating periodic CPU interrupts; and implementing a free-running timer. Both have many applications in embedded systems:</p><ul>
<li>Measuring time between events</li>
<li>Generating periodic events</li>
<li>Synchronizing actions</li>
<li>Real-time clocking</li>
<li>Polling.</li>
</ul>
<h1><a class="anchor" id="group_wdc_configuration"></a>
Configuration Considerations</h1>
<p>The WDC block contains three sub-counters, each of which can be configured for one of the system utility functions - free running counter or periodic interrupts.</p>
<p>A simplified diagram of the WDC hardware is shown below: </p><div class="image">
<img src="wdc.png" alt="wdc.png"/>
</div>
<p> The frequency of the periodic interrupts for C0 and C1 counters can be configured using the Match value using <a class="el" href="group__group__wdc__functions.html#ga69669e3a0f7ca147bf576ad6feccb6d0">Cy_WDC_SetMatch()</a> together with Clear on match option, which can be set using <a class="el" href="group__group__wdc__functions.html#gadfd4cbdc385cc479e1127157b66fa553">Cy_WDC_SetClearOnMatch()</a> function. When Clear on match option is not set, the periodic interrupts of the C0 and C1 16-bit sub-counters occur after 65535 counts and the match value defines the shift between interrupts (see the figure below). The enabled Clear on match option resets the counter when the interrupt occurs.</p>
<p><b>Clear on match is disabled: </b> </p><div class="image">
<img src="wdc_C0_C1_NoClearOnMatch.png" alt="wdc_C0_C1_NoClearOnMatch.png"/>
</div>
<p><b>Clear on match is enabled: </b> </p><div class="image">
<img src="wdc_C0_C1_ClearOnMatch.png" alt="wdc_C0_C1_ClearOnMatch.png"/>
</div>
<p>32-bit sub-counter C2 does not have the Clear on match option. The interrupt of counter C2 occurs when the counts equal 2<sup>Toggle bit</sup> value. For example: when toggle bit = 0, C2 will generate interrupt every WDC clock source rising edge; when toggle bit = 31, C2 will generate interrupt every 2<sup>31</sup> WDC clock source rising edge. </p><div class="image">
<img src="wdc_C2.png" alt="wdc_C2.png"/>
</div>
<p>WDC initialization can be divided into a number of sequential steps listed below:</p><ul>
<li><a class="el" href="group__group__wdc.html#group_wdc_config">Configure WDC</a></li>
<li><a class="el" href="group__group__wdc.html#group_wdc_cascade">Counters Cascading</a></li>
<li><a class="el" href="group__group__wdc.html#group_wdc_interrupt">Configure Interrupt</a></li>
<li><a class="el" href="group__group__wdc.html#group_wdc_enable">Enable Counters</a></li>
</ul>
<h2><a class="anchor" id="group_wdc_config"></a>
Configure WDC</h2>
<p>To set up a WDC, provide the configuration parameters in the <a class="el" href="structcy__stc__wdc__config__t.html">cy_stc_wdc_config_t</a> structure. Then call <a class="el" href="group__group__wdc__functions.html#ga815bbc01c7cfb8c9c4d916b5d544303f">Cy_WDC_Init()</a> to initialize the driver.</p>
<div class="fragment"><div class="line">    <a class="code" href="structcy__stc__wdc__config__t.html">cy_stc_wdc_config_t</a> wdcConfig =</div><div class="line">    {</div><div class="line">        <span class="comment">/* counter0Match        */</span> 39999U,              <span class="comment">/* Divide ILO to 1 sec period (40KHz ILO) */</span></div><div class="line">        <span class="comment">/* counter1Match        */</span> 0U,                  <span class="comment">/* Not used */</span></div><div class="line">        <span class="comment">/* counter2ToggleBit    */</span> 0U,                  <span class="comment">/* Not used */</span></div><div class="line">        <span class="comment">/* counter0Interrupt    */</span> <span class="keyword">true</span>,                <span class="comment">/* Enable counter 1 interrupt */</span></div><div class="line">        <span class="comment">/* counter1Interrupt    */</span> <span class="keyword">false</span>,               <span class="comment">/* Not used */</span></div><div class="line">        <span class="comment">/* counter2Interrupt    */</span> <span class="keyword">false</span>,               <span class="comment">/* Not used */</span></div><div class="line">        <span class="comment">/* counter0ClearOnMatch */</span> <span class="keyword">true</span>,                <span class="comment">/* Clean on match for counter 0 to use as configurable divider */</span></div><div class="line">        <span class="comment">/* counter1ClearOnMatch */</span> <span class="keyword">false</span>,               <span class="comment">/* Not used */</span></div><div class="line">        <span class="comment">/* countersCascade      */</span> <a class="code" href="group__group__wdc__macros__cascading__masks.html#gabdf0a908fc8825bcaa1e36fb8923ac78">CY_WDC_CASCADE_NONE</a>, <span class="comment">/* No cascading */</span></div><div class="line">        <span class="comment">/* clockSource          */</span> <a class="code" href="group__group__wdc__enums.html#gga2f558686b71ae60686d9c3ba6f17e6baad6a642e3d7885b877d05696bd3ee97ff">CY_WDC_CLOCK_ILO</a>,    <span class="comment">/* Use ILO as clock source */</span></div><div class="line">    };</div><div class="line">    </div><div class="line">    <a class="code" href="group__group__wdc__functions.html#ga815bbc01c7cfb8c9c4d916b5d544303f">Cy_WDC_Init</a>(WCO, &amp;wdcConfig);</div></div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>Before initialization of WDC, ensure that the selected WDC clock source is enabled. Refer to <a class="el" href="group__group__sysclk__ilo.html">Internal Low-Speed Oscillator (ILO)</a> and <a class="el" href="group__group__sysclk__wco.html">Watch Crystal Oscillator (WCO)</a> sections of SysClk driver documentation.</dd></dl>
<h2><a class="anchor" id="group_wdc_cascade"></a>
Counters Cascading</h2>
<p>The WDC counter can be cascaded in order to achieve longer wait periods. When a counter is cascaded, it uses the previous counter event signal in order to perform the increment operation instead of the WDC clock source. For example, to configure a WDC to generate interrupts approx. every 20 seconds using ILO clock source (40KHz), the total timer period should be set to 40000 * 20 = 800000 counts, which is above the 16-bit single timer resolution. For a long period delays, 32-bit counter 2 can be used, but it only allows fixed period values. In our case, it will generate interrupts with 13.1 seconds (2^19 = 524288) or 26.2 seconds (2^20 = 1048576) periods. To achieve higher timing precision, counters 0 and 1 can be cascaded. In this case, the following configuration structure can be used:</p>
<div class="fragment"><div class="line"><a class="code" href="structcy__stc__wdc__config__t.html">cy_stc_wdc_config_t</a> wdcConfigCascade =</div><div class="line">{</div><div class="line">    <span class="comment">/* counter0Match        */</span> 39999U,                      <span class="comment">/* Divide ILO to 1 sec period (40KHz ILO) */</span></div><div class="line">    <span class="comment">/* counter1Match        */</span> 20U,                         <span class="comment">/* Divide 1 sec period form counter 0 to form 20 sec period*/</span></div><div class="line">    <span class="comment">/* counter2ToggleBit    */</span> 0U,                          <span class="comment">/* Not used */</span></div><div class="line">    <span class="comment">/* counter0Interrupt    */</span> <span class="keyword">false</span>,                       <span class="comment">/* Disable counter 0 interrupt */</span></div><div class="line">    <span class="comment">/* counter1Interrupt    */</span> <span class="keyword">true</span>,                        <span class="comment">/* Enable counter 1 interrupt */</span></div><div class="line">    <span class="comment">/* counter2Interrupt    */</span> <span class="keyword">false</span>,                       <span class="comment">/* Not used */</span></div><div class="line">    <span class="comment">/* counter0ClearOnMatch */</span> <span class="keyword">true</span>,                        <span class="comment">/* Clean on match for counter 0 to use as configurable divider */</span></div><div class="line">    <span class="comment">/* counter1ClearOnMatch */</span> <span class="keyword">true</span>,                        <span class="comment">/* Clean on match for counter 0 to use as configurable divider */</span></div><div class="line">    <span class="comment">/* countersCascade      */</span> <a class="code" href="group__group__wdc__macros__cascading__masks.html#ga15bb2f082e1bdbb9447fab9dba1e09c0">CY_WDC_CASCADE_COUNTERS01</a>,   <span class="comment">/* Cascade 0 and 1 counters */</span></div><div class="line">    <span class="comment">/* clockSource          */</span> <a class="code" href="group__group__wdc__enums.html#gga2f558686b71ae60686d9c3ba6f17e6baad6a642e3d7885b877d05696bd3ee97ff">CY_WDC_CLOCK_ILO</a>,            <span class="comment">/* Use ILO as clock source */</span></div><div class="line">};</div></div><!-- fragment --><p> Alternatively, the same settings can be applied using the corresponding WDC functions after calling the <a class="el" href="group__group__wdc__functions.html#ga815bbc01c7cfb8c9c4d916b5d544303f">Cy_WDC_Init</a> function. Refer to <a class="el" href="group__group__wdc__functions.html">Functions</a> for details.</p>
<p>There are four possible cascading options:</p><ul>
<li><a class="el" href="group__group__wdc__macros__cascading__masks.html#gabdf0a908fc8825bcaa1e36fb8923ac78">CY_WDC_CASCADE_NONE</a> - all counters work independently</li>
<li><a class="el" href="group__group__wdc__macros__cascading__masks.html#ga15bb2f082e1bdbb9447fab9dba1e09c0">CY_WDC_CASCADE_COUNTERS01</a> - counters 0 and 1 are cascaded. If Clean on match is set for both counters total cascaded period will be equal to (C0_Match + 1) * C1_Match</li>
<li><a class="el" href="group__group__wdc__macros__cascading__masks.html#ga11f4054b6e5d5b794828ba932cfe857d">CY_WDC_CASCADE_COUNTERS12</a> - counters 1 and 2 are cascaded. If Clean on match is set for counter 1 total cascaded period will be equal to (C1_Match + 1) * 2<sup>C2_Toggle_bit</sup></li>
<li><a class="el" href="group__group__wdc__macros__cascading__masks.html#gaa6871e7c9bf919ae5f8294595f90f7b3">CY_WDC_CASCADE_ALL</a> - counters 0, 1 and 2 are cascaded. If Clean on match is set for counters 0 and 1 counters total cascaded period will be equal to (C0_Match + 1) * C1_Match * 2<sup>C2_Toggle_bit</sup>.</li>
</ul>
<h2><a class="anchor" id="group_wdc_interrupt"></a>
Configure Interrupt</h2>
<p>All counter interrupts are OR'd together to form a single combined WDC interrupt. To configure a WDC interrupt, initialize the referenced interrupt by setting the priority and the interrupt vector using <a class="el" href="group__group__sysint__functions.html#gab2ff6820a898e9af3f780000054eea5d">Cy_SysInt_Init()</a> of the SysInt driver and provide interrupt handler:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> WDC_Isr(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    uint32_t intStatus = <a class="code" href="group__group__wdc__functions.html#gaa47ce8aec249f0f21f51ac94622b27b2">Cy_WDC_GetInterruptStatus</a>(WCO);</div><div class="line">    <a class="code" href="group__group__wdc__functions.html#gae10b219e54fde3bc0d5eee1c173620e9">Cy_WDC_ClearInterrupt</a>(WCO, intStatus);</div><div class="line">    </div><div class="line">    <span class="keywordflow">if</span>(0U != (intStatus &amp; <a class="code" href="group__group__wdc__macros.html#gaf64abef99e252788f2dd2bce56ec757e">CY_WDC_COUNTER0_Msk</a>))</div><div class="line">    {</div><div class="line">        <span class="comment">/* Process counter 0 interrupt */</span></div><div class="line">    }</div><div class="line">    </div><div class="line">    <span class="keywordflow">if</span>(0U != (intStatus &amp; <a class="code" href="group__group__wdc__macros.html#ga237f83da599475cb04f7939310b1a4c2">CY_WDC_COUNTER1_Msk</a>))</div><div class="line">    {</div><div class="line">        <span class="comment">/* Process counter 1 interrupt */</span></div><div class="line">    }</div><div class="line">    </div><div class="line">    <span class="keywordflow">if</span>(0U != (intStatus &amp; <a class="code" href="group__group__wdc__macros.html#gaec8a8f1c85695cee028b62b70157e6a9">CY_WDC_COUNTER2_Msk</a>))</div><div class="line">    {</div><div class="line">        <span class="comment">/* Process counter 2 interrupt */</span></div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><div class="fragment"><div class="line">    <span class="comment">/* Configuration structure for WDC interrupt */</span></div><div class="line">    <a class="code" href="structcy__stc__sysint__t.html">cy_stc_sysint_t</a> wdcIrqCfg =</div><div class="line">    {</div><div class="line">        .<a class="code" href="structcy__stc__sysint__t.html#a6da08d81da65a7f93d3e4c46a4b8d950">intrSrc</a> = wco_interrupt_IRQn,</div><div class="line">        .intrPriority = 3U,</div><div class="line">    };</div><div class="line">    </div><div class="line">    <span class="comment">/* Assign interrupt handler function and set interrupt priority */</span></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__group__sysint__enums.html#gga01619b224f9d5c23915e51783ea184c8af7db469e7f8cd5cb7917d1324005eb89">CY_SYSINT_SUCCESS</a> != <a class="code" href="group__group__sysint__functions.html#gab2ff6820a898e9af3f780000054eea5d">Cy_SysInt_Init</a>(&amp;wdcIrqCfg, WDC_Isr))</div><div class="line">    {</div><div class="line">        <span class="comment">/* Insert the error handling here */</span></div><div class="line">    }</div><div class="line">    </div><div class="line">    <span class="comment">/* Enable the WDC interrupt */</span></div><div class="line">    NVIC_EnableIRQ(wdcIrqCfg.<a class="code" href="structcy__stc__sysint__t.html#a6da08d81da65a7f93d3e4c46a4b8d950">intrSrc</a>);</div></div><!-- fragment --><p> Additionally, global interrupts should be enabled.</p>
<h2><a class="anchor" id="group_wdc_enable"></a>
Enable Counters</h2>
<p>The last configuration step enables the configured counters using <a class="el" href="group__group__wdc__functions.html#gabd2a4e06b7fc76f8738cc1e721d30758">Cy_WDC_Enable</a> function.</p>
<div class="fragment"><div class="line">    <span class="comment">/* Enable counter 0 */</span></div><div class="line">    <a class="code" href="group__group__wdc__functions.html#gabd2a4e06b7fc76f8738cc1e721d30758">Cy_WDC_Enable</a>(WCO, CY_WDC_COUNTER0_Msk, <a class="code" href="group__group__wdc__macros.html#ga44e4ac9709fed40c64661c25aa870abb">CY_WDC_CLK_ILO_3CYCLES_US</a>);</div></div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>In addition to WDCs, each device has a separate watchdog timer (WDT) to generate a watchdog reset or periodic interrupts. For detail on the WDT, see <a class="el" href="group__group__wdt.html">WDT (Watchdog Timer)</a> section.</dd></dl>
<h1><a class="anchor" id="group_wdc_more_information"></a>
More Information</h1>
<p>For detail on the WDC peripheral, refer to the technical reference manual (TRM).</p>
<h1><a class="anchor" id="group_wdc_changelog"></a>
Changelog</h1>
<table class="doxtable">
<tr>
<th>Version</th><th>Changes</th><th>Reason for Change </th></tr>
<tr>
<td>1.0.2 </td><td>Update the paths to the code snippets. </td><td>PDL structure update.  </td></tr>
<tr>
<td>1.0.1 </td><td>Corrected source code comments text. </td><td></td></tr>
<tr>
<td>1.0 </td><td>Initial version </td><td></td></tr>
</table>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
API Reference</h2></td></tr>
<tr class="memitem:group__group__wdc__macros"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__wdc__macros.html">Macros</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__wdc__functions"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__wdc__functions.html">Functions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__wdc__data__structures"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__wdc__data__structures.html">Data Structures</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__wdc__enums"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__wdc__enums.html">Enumerated Types</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>CAT2 Peripheral Driver Library</b> by <b>Infineon Technologies</b>.
            All rights reserved.
        </li>
    </ul>
</div>
-->
</body>
</html>
