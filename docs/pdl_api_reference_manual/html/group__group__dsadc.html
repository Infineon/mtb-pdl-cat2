<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CAT2 Peripheral Driver Library: DSADC        (Delta-Sigma ADC)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CAT2 Peripheral Driver Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__group__dsadc.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Modules</a>  </div>
  <div class="headertitle">
<div class="title">DSADC (Delta-Sigma ADC)</div>  </div>
</div><!--header-->
<div class="contents">

<p>The ADC driver provides a function API to manage the Delta-Sigma ADC.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:group__group__dsadc__macro"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__dsadc__macro.html">Macros</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__dsadc__functions"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__dsadc__functions.html">Functions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__dsadc__data__structures"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__dsadc__data__structures.html">Data Structures</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__dsadc__enums"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__dsadc__enums.html">Enumerated Types</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>The ADC driver provides a function API to manage the Delta-Sigma ADC. </p>
<dl class="section note"><dt>Note</dt><dd>Supported on PSOC4 HVPA only.</dd></dl>
<p>The functions and other declarations used in this driver are in cy_dsadc.h. You can include cy_pdl.h to get access to all functions and declarations in the PDL.</p>
<p>The PSOC4 HVPA PACSS has two delta-sigma analog-to-digital converters (ADCs) to perform 16 - 20+ bit measurements at a sample rate of up to 48 ksps for continuous measurements. Higher resolution can be achieved at slower sample rates by accumulating more modulator results in the decimator.</p>
<p>Analog-to-digital converters (ADCs) are split into the analog part and the digital part. The PSOC4 HVPA PACSS has two analog parts followed by four digital parts:</p><ul>
<li>Common part, which applies (see <a class="el" href="group__group__dsadc.html#common">Common part</a>) to the entire system.</li>
<li>Two analog parts (see <a class="el" href="group__group__dsadc.html#achan">Analog part</a>).</li>
<li>Four digital parts (see <a class="el" href="group__group__dsadc.html#dchan">Digital part</a>).</li>
</ul>
<p><a class="anchor" id="common"></a><b>Common part</b></p>
<p>The common part contains:</p><ul>
<li><a class="el" href="group__group__dsadc.html#Sequencer">Sequencers</a>.</li>
<li><a class="el" href="group__group__dsadc.html#Temperature">Temperature sensors</a>.</li>
<li><a class="el" href="group__group__dsadc.html#AGC">Auto-Gain Controller</a>.</li>
<li>Logic that mixes data between digital and analog.</li>
</ul>
<p><a class="anchor" id="Sequencer"></a><b>Sequencers</b></p>
<p>Sequencer is based on finite state machine (FSM). The PACSS has two sequencers which are associated with the two analog front-end channels (see <a class="el" href="group__group__dsadc.html#achan">Analog part</a>).</p>
<div class="image">
<img src="seq_adc.png" alt="seq_adc.png"/>
<div class="caption">
Sequencers</div></div>
<p> When triggered, the sequencer loads the input pin selection of the first assigned digital channel (see <a class="el" href="group__group__dsadc.html#dchan">Digital part</a>) then starts the decimator which initializes the modulator (see <a class="el" href="group__group__dsadc.html#DSM">Delta-sigma modulator</a>) to start the conversion.</p>
<p>The modulator output data is transferred to the assigned digital channel.</p>
<p>There are two supported conversion modes: incremental (single sample) and continuous. When a conversion is finished, the sequencer is notified by the decimator.</p>
<p><a class="anchor" id="Temperature"></a><b>Temperature sensors</b></p>
<p>On-die temperature sensor</p>
<p>On-die temperature measurements are made with an internal temperature sensor by measuring bipolar "base-emitter voltage" (VBE) at different current densities and calculating temperature.</p>
<p>External temperature sensor</p>
<p>The external temperature sensor uses a fixed resistor and a temperature-dependent resistor (generally a negative temperature coefficient thermistor) - the resistor and thermistor form a voltage divider whose output voltage is temperature dependent. When enabled, the External Temperature Sensor block provides power to the off-chip temperature-dependent divider (and a reference supply for the ADC) of VDDD/3.</p>
<p><a class="anchor" id="AGC"></a><b>Auto-Gain Controller</b></p>
<p>The AGC can automatically control the gain of either channel. AGC circuits typically monitor either the input voltage or output of the PGA and increase gain when signal amplitude is below a certain threshold or reduce gain when above another threshold. This function can also be achieved with a low-resolution A/D converter with digital comparison for gain selection.</p>
<div class="image">
<img src="agc_adc.png" alt="agc_adc.png"/>
<div class="caption">
Auto-Gain Control</div></div>
<p> <a class="anchor" id="achan"></a><b>Analog part</b></p>
<div class="image">
<img src="analog_adc.png" alt="analog_adc.png"/>
<div class="caption">
Analog ADC part</div></div>
<p> The analog portion of the ADCs consists:</p><ul>
<li>"Input/diagnostic multiplexer"</li>
<li><a class="el" href="group__group__dsadc.html#pga">Programmable gain amplifier (PGA)</a></li>
<li><a class="el" href="group__group__dsadc.html#aaf">Anti-alias filter (AAF)</a></li>
<li><a class="el" href="group__group__dsadc.html#buffer">Buffer amplifier</a></li>
<li><a class="el" href="group__group__dsadc.html#DSM">Delta-sigma modulator</a></li>
</ul>
<p>The analog DSM system receives a differential signal selected through the analog multiplexer. This differential signal is received by a programmable gain amplifier (PGA). The output of the PGA feeds a low-pass anti-alias filter (AAF) with a bandwidth of ~30 kHz. A buffer amplifier drives the DSM modulator - this amplifier has high bandwidth to settle the modulator capacitors to better than 16 bits each time they are settled. The modulator uses capacitor dividers to set gain. The modulator is a third order with switched capacitor amplifier circuits. The modulator produces a multi-level digital bitstream sent to the digital channel. PGA and buffer amplifiers have offset trim, which reduces to offset these sub-blocks to &lt;0.5 mV (across temperature). Offset trim is done during production. To reduce offset further, there is circuit chopping in PGA, buffer, and modulator. Chopping frequency is programmable from Fs/2 to Fs/256 (in 2's powers), where default is Fs/32. Fs here is the modulator clock.</p>
<p><a class="anchor" id="pga"></a><b>Programmable gain amplifier (PGA)</b></p>
<p>The PGA is a fully-differential pseudo-instrumentation amplifier implemented with two Opamps. The PGA can be programmed for gains of 1 to 32. The PGA gain can be programmed via the internal bus or comes from the AGC. The PGA input range is -250 mV to 1.2 V (For RSH/RSL input pins, the input range is -300 mV to +300 mV). A negative pump is used to allow inputs to be below ground. This PGA has low-noise and input capacitance of about 1.5 pF. The PGA includes input/output chopping, which the sequencer can enable, and digital offset trim.</p>
<p><a class="anchor" id="aaf"></a><b>Anti-alias filter (AAF)</b></p>
<p>The anti-alias filter (AAF) is a first order RC filter with a 30-kHz corner frequency. 30 kHz is selected to give 40 dB attenuation at modulator sampling frequency, which is 3.072 MHz. The filter also has bypass switches, which allow the filter to be removed from the signal path, and a set of fast switches that bypass the "R" in the RC filter, moving the corner frequency approximately 600 kHz.</p>
<p>Following shows the AAF. </p><div class="image">
<img src="aaf_adc.png" alt="aaf_adc.png"/>
<div class="caption">
Anti-alias filter (AAF)</div></div>
<p> To alternately measure two signals with one channel, the anti-alias filter can be temporarily shorted since the AAF needs about 60 mks to settle to 16-bits before conversions can start - the measurement sample rate needs to slow to 4 ksps if the AAF is not bypassed.</p>
<p><a class="anchor" id="buffer"></a><b>Buffer amplifier</b></p>
<p>The buffer amplifier converts the high-impedance AAF filter output to low impedance for driving the DSM modulator. The buffer includes digital offset trim and chopping, which can be enabled or disabled with a control signal.</p>
<p><a class="anchor" id="DSM"></a><b>Delta-sigma modulator</b></p>
<p>The delta-sigma modulator works by taking the difference between input and feedback signals (delta) and accumulating that difference (sigma) to produce a digital output.</p>
<p>The digital stream goes to a decimator (see <a class="el" href="group__group__dsadc.html#dchan">dchan</a>), which converts the fast oversampled bit stream into slower high-resolution results.</p>
<p><a class="anchor" id="OCD"></a><b>Overcurrent detector</b></p>
<p>The overcurrent detector (OCD) provides a safety mechanism to detect battery over current conditions. OCD detection is from the differential current sense inputs, RSHx and RSLx and support both charging and discharging over current. The detect threshold is programmable via an internal DAC. For safety, the OCD operated independently of the ADC which also provides faster detection of over current conditions. One OCD is associated with each set of current sense inputs (RSHx/RSLx).</p>
<p><a class="anchor" id="dchan"></a><b>Digital part</b></p>
<div class="image">
<img src="digital_adc.png" alt="digital_adc.png"/>
<div class="caption">
Digital ADC part</div></div>
<p> The digital data system has four digital channels that include:</p><ul>
<li><a class="el" href="group__group__dsadc.html#scaler">scaler</a></li>
<li><a class="el" href="group__group__dsadc.html#decimator">decimator</a></li>
<li><a class="el" href="group__group__dsadc.html#compensation">compensation</a></li>
<li>FIR filter</li>
<li>accumulator</li>
<li>comparator</li>
<li>offset, and gain calibrations</li>
</ul>
<p>The digital channels process outputs from either of the two analog channels. Two digital channels are with FIR filter and the others are without the FIR Filter. The digital channel without FIR filter has every other feature. The channels are typically used for current, voltage, temperature, and diagnostic measurements although they can be associated with any inputs. The digital system of the PACSS is largely autonomous; it performs acquisitions, filtering, post-processing, and data storage without firmware intervention. This allows real-time measurements without loading the CPU.</p>
<p>The digital data system optionally generates various interrupts to enable further processing of the results, or to handle diagnosis errors.</p>
<p><a class="anchor" id="scaler"></a><b>Scaler</b></p>
<p>A scaler is used so the LSB of the ADC can have the same weight regardless of gain. The LSB is established by the ADC resolution at maximum gain - for the current channel, the LSB is 0.715 mA with a gain of 512. The scaler multiplies the output of the modulator by 512/Gain to normalize results and maintain 0.715 mA for the LSB regardless of gain setting. To multiply by 2, the scaler shifts results up one bit. To cover a gain range of 1 to 512 means results can be shifted up to 9 bits.</p>
<p><a class="anchor" id="decimator"></a><b>Decimator</b></p>
<p>There are two decimators - one is configurable as Sinc3 or Sinc4, and the other is used as rate reducer and is a Sinc2. The first decimator can be configured for third or fourth order operation. The decimation rate (DR) is programmable and can range from 2 to 128. Both the third and fourth order decimator configurations can be used for incremental or continuous mode.</p>
<p>The second decimator (rate reducer) DR2 is programmable and can range from 1 to 32.</p>
<dl class="section note"><dt>Note</dt><dd>For instance, with a 3.072 MHz clock, DR is set to 64, and DR2 is set to 6 to achieve an 8 ksps sample rate.</dd></dl>
<p><a class="anchor" id="compensation"></a><b>Compensation</b></p>
<p>Compensation block multiplies results for gain adjustment and adds constants for offset correction. Up to 64 tap finite impulse response (FIR) filter with programmable coefficients follows the compensation block. Results are then normalized to remove unused bits and averaging, accumulation, and threshold detection can be performed.</p>
<h1><a class="anchor" id="group_dsadc_on_die_configuration"></a>
On-Die Temperature Initialization</h1>
<p>This section describes the process of initializing the on-die temperature sensor using the Delta-Sigma ADC (DSADC). The initialization includes enabling the temperature sensor, configuring the measurement parameters, performing the measurements to calculate the current ratio for calibration and then performing the temperature measurements.</p>
<dl class="section note"><dt>Note</dt><dd>In actual applications, before configuring the temperature sensor <a class="el" href="structcy__stc__dsadc__config__t.html">cy_stc_dsadc_config_t</a> should be initialized, and <a class="el" href="group__group__dsadc__base__common__functions.html#ga8a93938ec985db08350a1bdbb1bab08c">Cy_DSADC_Init</a> should be called.</dd></dl>
<p><a class="anchor" id="stucture"></a><b>Configuration structure</b></p>
<p>This snippet demonstrates how to create and initialize the configuration structures for the on-die temperature sensor.</p>
<p>Two configurations are defined:</p><ul>
<li>one_config: Used for the first measurement with a lower current (e.g., 1x current).</li>
<li>unit_config: Used for the second measurement with a higher current (e.g., 9x current).</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The configuration structures are initialized for demonstration purposes only. The actual values for the current source, load mode, current, and bipolar units should be set using function <a class="el" href="group__group__dsadc__base__common__functions.html#gaaac8beaf3a1e5cfc606a6a2af053a981">Cy_DSADC_InitializeDieTempConfigs</a>.</dd></dl>
<div class="fragment"><div class="line">    <span class="comment">/* Temperature sensor one configuration for the 1 measurement</span></div><div class="line"><span class="comment">     * - AREF Current Source</span></div><div class="line"><span class="comment">     * - Start with mask of 1x current</span></div><div class="line"><span class="comment">     * - PNP load mode</span></div><div class="line"><span class="comment">     * - Use 4 bipolar units</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <a class="code" href="structcy__stc__dsadc__temperature__config__t.html">cy_stc_dsadc_temperature_config_t</a> one_config =</div><div class="line">    {</div><div class="line">        .<a class="code" href="structcy__stc__dsadc__temperature__config__t.html#aa61835d6b8a9f293c06849601c22751e">currentSource</a>  = <a class="code" href="group__group__enum__common.html#ggaaac77ee16ac013515c17d3fb4cff1994a8bdeec29a7375e6e6b815394715dca49">CY_DSADC_TEMPERATURE_CURRENT_SOURCE_AREF</a>,</div><div class="line">        .current        = 1U,</div><div class="line">        .loadMode       = <a class="code" href="group__group__enum__common.html#gga072d1210840fab685a1ea0dd2f291ba0a8dff327067966f114ad7bd77667bb57c">CY_DSADC_TEMPERATURE_LOAD_MODE_PNP</a>,</div><div class="line">        .bipolar        = 0xFU</div><div class="line">    };</div><div class="line"></div><div class="line">    <span class="comment">/* Temperature sensor unit configuration for the 1 measurement:</span></div><div class="line"><span class="comment">     * - AREF Current Source</span></div><div class="line"><span class="comment">     * - Mask of 9x current</span></div><div class="line"><span class="comment">     * - PNP load mode</span></div><div class="line"><span class="comment">     * - Use 4 bipolar units</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <a class="code" href="structcy__stc__dsadc__temperature__config__t.html">cy_stc_dsadc_temperature_config_t</a> unit_config =</div><div class="line">    {</div><div class="line">        .<a class="code" href="structcy__stc__dsadc__temperature__config__t.html#aa61835d6b8a9f293c06849601c22751e">currentSource</a>  = <a class="code" href="group__group__enum__common.html#ggaaac77ee16ac013515c17d3fb4cff1994a8bdeec29a7375e6e6b815394715dca49">CY_DSADC_TEMPERATURE_CURRENT_SOURCE_AREF</a>,</div><div class="line">        .current        = 0x1FFU,</div><div class="line">        .loadMode       = <a class="code" href="group__group__enum__common.html#gga072d1210840fab685a1ea0dd2f291ba0a8dff327067966f114ad7bd77667bb57c">CY_DSADC_TEMPERATURE_LOAD_MODE_PNP</a>,</div><div class="line">        .bipolar        = 0xFU</div><div class="line">    };</div></div><!-- fragment --><p> <a class="anchor" id="initialization"></a><b>Initialization and Calibration</b></p>
<p>To ensure proper initialization during configuration, it is important to maintain appropriate delays. Temperature measurement occurs in two stages: first, on-die calibration is performed, and only after that, the actual temperature measurement is conducted.</p>
<p>After enabling the on-die sensor, the structures are initialized using the <a class="el" href="group__group__dsadc__base__common__functions.html#gaaac8beaf3a1e5cfc606a6a2af053a981">Cy_DSADC_InitializeDieTempConfigs</a> function to perform two current measurements on the resistor for 1x and 9x currents. The obtained values are shifted as required for 29-bit measurements and passed to the <a class="el" href="group__group__dsadc__base__common__functions.html#gaa48fe81a31d3cad3f2cd507a3ac04e93">Cy_DSADC_CalcCurrentRatio</a> function to get the ratio of the resistor measurements and normalize the results.</p>
<div class="fragment"><div class="line">    <span class="comment">/* Cy_DSADC_CalcCurrentRatio and Cy_DSADC_CalcDieTemp expects a delta between two 29-bit measurements.</span></div><div class="line"><span class="comment">     * This example is configured for 21-bit results so they must be shifted before</span></div><div class="line"><span class="comment">     * calculating the temperature.</span></div><div class="line"><span class="comment">     */</span></div><div class="line"><span class="preprocessor">    #define CY_DSADC_GET_DIE_TEMP_SHIFT              (8)</span></div><div class="line"></div><div class="line">    <span class="comment">/* Enable Temperature Sensor. */</span></div><div class="line">    <a class="code" href="group__group__dsadc__base__common__functions.html#gaa041b6efd411a39de68b1f7c4ecae913">Cy_DSADC_EnableTemperature</a>(PACSS_MMIO);</div><div class="line">    <span class="comment">/* Wait 1000Us to allow it to settle. */</span></div><div class="line">    <a class="code" href="group__group__syslib__functions.html#ga9d2ffe4829c636ad78eaae5043fd6ae6">Cy_SysLib_DelayUs</a>(1000UL);</div><div class="line"></div><div class="line">    <span class="comment">/* Initialize the die temp configurations structures based on the data stored in SFLASH. */</span></div><div class="line">    <a class="code" href="group__group__dsadc__base__common__functions.html#gaaac8beaf3a1e5cfc606a6a2af053a981">Cy_DSADC_InitializeDieTempConfigs</a>(&amp;one_config, &amp;unit_config, <a class="code" href="group__group__enum__common.html#gga45491e8d2fe78a2d28e5f97c37dfa093ae74053ee1cc061019f06947603dd8d48">CY_DSADC_TEMPERATURE_CONFIG_PRIMARY</a>, <a class="code" href="group__group__enum__common.html#gga45f8754e7085fa1d507dbd3e5ae4d769acb46f1d7322c6c181c3e3d8547bec2e4">CY_DSADC_TEMPERATURE_MEASUREMENT_RESISTOR</a>);</div><div class="line">    <span class="comment">/* Each time the die temp is reconfigured, allow it to settle. */</span></div><div class="line">    <a class="code" href="group__group__syslib__functions.html#ga9d2ffe4829c636ad78eaae5043fd6ae6">Cy_SysLib_DelayUs</a>(<a class="code" href="group__group__dsadc__macro.html#ga5423250c82b5757a53f910d4c14284ee">CY_DSADC_TEMPERATURE_SENSOR_DELAY_US</a>);</div><div class="line"></div><div class="line">    <span class="comment">/* Get the ratio of the resistor measurements to normalize the results. */</span></div><div class="line">    <a class="code" href="group__group__dsadc__base__common__functions.html#ga077b6c33223c19a85b86ff92d1b27b24">Cy_DSADC_InitTemperature</a>(PACSS_MMIO, &amp;one_config);</div><div class="line">    <span class="comment">/* Each time the die temp is reconfigured, allow it to settle. */</span></div><div class="line">    <a class="code" href="group__group__syslib__functions.html#ga9d2ffe4829c636ad78eaae5043fd6ae6">Cy_SysLib_DelayUs</a>(<a class="code" href="group__group__dsadc__macro.html#ga5423250c82b5757a53f910d4c14284ee">CY_DSADC_TEMPERATURE_SENSOR_DELAY_US</a>);</div><div class="line"></div><div class="line">    <a class="code" href="group__group__dsadc__ext__achan__functions.html#ga3b3c3ca9565225f7251fbce1db78019e">Cy_DSADC_StartConversionAchan</a>(PACSS_ACHAN1);</div><div class="line">    <span class="comment">/* Get result when conversion is complete. */</span></div><div class="line">    int32_t dieTempOneCounts = <a class="code" href="group__group__dsadc__base__dchan__functions.html#gac24a4355de02b3f7ccb9cb597cb5cadb">Cy_DSADC_GetResult</a>(PACSS_DCHAN0);</div><div class="line"></div><div class="line">    <span class="comment">/* Configure for the unit measurement */</span></div><div class="line">    <a class="code" href="group__group__dsadc__base__common__functions.html#ga077b6c33223c19a85b86ff92d1b27b24">Cy_DSADC_InitTemperature</a>(PACSS_MMIO, &amp;unit_config);</div><div class="line">    <span class="comment">/* Each time the die temp is reconfigured, allow it to settle. */</span></div><div class="line">    <a class="code" href="group__group__syslib__functions.html#ga9d2ffe4829c636ad78eaae5043fd6ae6">Cy_SysLib_DelayUs</a>(<a class="code" href="group__group__dsadc__macro.html#ga5423250c82b5757a53f910d4c14284ee">CY_DSADC_TEMPERATURE_SENSOR_DELAY_US</a>);</div><div class="line"></div><div class="line">    <a class="code" href="group__group__dsadc__ext__achan__functions.html#ga3b3c3ca9565225f7251fbce1db78019e">Cy_DSADC_StartConversionAchan</a>(PACSS_ACHAN1);</div><div class="line">    <span class="comment">/* Get result when conversion is complete. */</span></div><div class="line">    int32_t dieTempUnitCounts = <a class="code" href="group__group__dsadc__base__dchan__functions.html#gac24a4355de02b3f7ccb9cb597cb5cadb">Cy_DSADC_GetResult</a>(PACSS_DCHAN0);</div><div class="line"></div><div class="line">    <span class="comment">/* Calculate the current ratio for the die temp measurement. */</span></div><div class="line">    uint32_t currentRatio = <a class="code" href="group__group__dsadc__base__common__functions.html#gaa48fe81a31d3cad3f2cd507a3ac04e93">Cy_DSADC_CalcCurrentRatio</a>(dieTempOneCounts &lt;&lt; CY_DSADC_GET_DIE_TEMP_SHIFT, dieTempUnitCounts &lt;&lt; CY_DSADC_GET_DIE_TEMP_SHIFT);</div><div class="line"></div></div><!-- fragment --><p> <a class="anchor" id="result"></a><b>Measurement process</b></p>
<p>The temperature measurement process requires reconfiguring the on-die structures to measure the temperature using the transistor load mode <a class="el" href="group__group__enum__common.html#gga45f8754e7085fa1d507dbd3e5ae4d769a61dad58ca4d0cb874c0d0cf6f9eb34b1">CY_DSADC_TEMPERATURE_MEASUREMENT_TRANSISTOR</a>. Result of two measurements are shifted as required for 29-bit measurements and calculated before value currentRatio passed to the function <a class="el" href="group__group__dsadc__base__common__functions.html#ga4d3af2d74399027cfc6d3675580bf4a8">Cy_DSADC_CalcDieTemp</a> to calculate the temperature in fixed point Q12.20 format.</p>
<div class="fragment"><div class="line"></div><div class="line">    <span class="comment">/* Update the die temp config for the transistor load mode */</span></div><div class="line">    <a class="code" href="group__group__dsadc__base__common__functions.html#gaaac8beaf3a1e5cfc606a6a2af053a981">Cy_DSADC_InitializeDieTempConfigs</a>(&amp;one_config, &amp;unit_config, <a class="code" href="group__group__enum__common.html#gga45491e8d2fe78a2d28e5f97c37dfa093ae74053ee1cc061019f06947603dd8d48">CY_DSADC_TEMPERATURE_CONFIG_PRIMARY</a>, <a class="code" href="group__group__enum__common.html#gga45f8754e7085fa1d507dbd3e5ae4d769a61dad58ca4d0cb874c0d0cf6f9eb34b1">CY_DSADC_TEMPERATURE_MEASUREMENT_TRANSISTOR</a>);</div><div class="line">    <span class="comment">/* Each time the die temp is reconfigured, allow it to settle. */</span></div><div class="line">    <a class="code" href="group__group__syslib__functions.html#ga9d2ffe4829c636ad78eaae5043fd6ae6">Cy_SysLib_DelayUs</a>(<a class="code" href="group__group__dsadc__macro.html#ga5423250c82b5757a53f910d4c14284ee">CY_DSADC_TEMPERATURE_SENSOR_DELAY_US</a>);</div><div class="line"></div><div class="line">    <span class="comment">/* Configure for the first measurement. */</span></div><div class="line">    <a class="code" href="group__group__dsadc__base__common__functions.html#ga077b6c33223c19a85b86ff92d1b27b24">Cy_DSADC_InitTemperature</a>(PACSS_MMIO, &amp;one_config);</div><div class="line">    <span class="comment">/* Each time the die temp is reconfigured, allow it to settle. */</span></div><div class="line">    <a class="code" href="group__group__syslib__functions.html#ga9d2ffe4829c636ad78eaae5043fd6ae6">Cy_SysLib_DelayUs</a>(<a class="code" href="group__group__dsadc__macro.html#ga5423250c82b5757a53f910d4c14284ee">CY_DSADC_TEMPERATURE_SENSOR_DELAY_US</a>);</div><div class="line"></div><div class="line">    <a class="code" href="group__group__dsadc__ext__achan__functions.html#ga3b3c3ca9565225f7251fbce1db78019e">Cy_DSADC_StartConversionAchan</a>(PACSS_ACHAN1);</div><div class="line">    <span class="comment">/* Get result when conversion is complete. */</span></div><div class="line">    dieTempOneCounts = <a class="code" href="group__group__dsadc__base__dchan__functions.html#gac24a4355de02b3f7ccb9cb597cb5cadb">Cy_DSADC_GetResult</a>(PACSS_DCHAN0);</div><div class="line"></div><div class="line">    <span class="comment">/* Configure for the unit measurement. */</span></div><div class="line">    <a class="code" href="group__group__dsadc__base__common__functions.html#ga077b6c33223c19a85b86ff92d1b27b24">Cy_DSADC_InitTemperature</a>(PACSS_MMIO, &amp;unit_config);</div><div class="line">    <span class="comment">/* Each time the die temp is reconfigured, allow it to settle. */</span></div><div class="line">    <a class="code" href="group__group__syslib__functions.html#ga9d2ffe4829c636ad78eaae5043fd6ae6">Cy_SysLib_DelayUs</a>(<a class="code" href="group__group__dsadc__macro.html#ga5423250c82b5757a53f910d4c14284ee">CY_DSADC_TEMPERATURE_SENSOR_DELAY_US</a>);</div><div class="line"></div><div class="line">    <a class="code" href="group__group__dsadc__ext__achan__functions.html#ga3b3c3ca9565225f7251fbce1db78019e">Cy_DSADC_StartConversionAchan</a>(PACSS_ACHAN1);</div><div class="line">    <span class="comment">/* Get result when conversion is complete. */</span></div><div class="line">    dieTempUnitCounts = <a class="code" href="group__group__dsadc__base__dchan__functions.html#gac24a4355de02b3f7ccb9cb597cb5cadb">Cy_DSADC_GetResult</a>(PACSS_DCHAN0);</div><div class="line"></div><div class="line">    <span class="comment">/* Calculate the on-die temperature. */</span></div><div class="line">    int32_t dieTemperature = <a class="code" href="group__group__dsadc__base__common__functions.html#ga4d3af2d74399027cfc6d3675580bf4a8">Cy_DSADC_CalcDieTemp</a>(dieTempOneCounts &lt;&lt; CY_DSADC_GET_DIE_TEMP_SHIFT,</div><div class="line">                                                  dieTempUnitCounts &lt;&lt; CY_DSADC_GET_DIE_TEMP_SHIFT,</div><div class="line">                                                  currentRatio,</div><div class="line">                                                  <a class="code" href="group__group__enum__common.html#gga45491e8d2fe78a2d28e5f97c37dfa093ae74053ee1cc061019f06947603dd8d48">CY_DSADC_TEMPERATURE_CONFIG_PRIMARY</a>);</div><div class="line"></div><div class="line">    <span class="comment">/* Convert the Q12.20 fixed point result to floating point. */</span></div><div class="line">    <a class="code" href="group__group__syslib__macros.html#ga4611b605e45ab401f02cab15c5e38715">float32_t</a> result = (<a class="code" href="group__group__syslib__macros.html#ga4611b605e45ab401f02cab15c5e38715">float32_t</a>)dieTemperature / (<a class="code" href="group__group__syslib__macros.html#ga4611b605e45ab401f02cab15c5e38715">float32_t</a>)(1U &lt;&lt; <a class="code" href="group__group__dsadc__macro.html#gae282b2106436e42163249a9d3bc98417">CY_DSADC_TEMPERATURE_FRACTION_BITS</a>);</div><div class="line"></div></div><!-- fragment --><h1><a class="anchor" id="group_dsadc_changelog"></a>
Changelog</h1>
<table class="doxtable">
<tr>
<th>Version</th><th>Changes</th><th>Reason for Change </th></tr>
<tr>
<td rowspan="2">1.10 </td><td>The OCD feature support was added for PSOC4 HVPA SPM 1.0 device. </td><td>New feature support.  </td></tr>
<tr>
<td>Updated interfaces of <a class="el" href="group__group__dsadc__base__common__functions.html#gafe88a3831fd1eac9f24d6de51ad6f25a">Cy_DSADC_CountsTo_Volts</a>, <a class="el" href="group__group__dsadc__base__common__functions.html#ga7239873610f58f8f10daced258410dee">Cy_DSADC_CountsTo_mVolts</a>, <a class="el" href="group__group__dsadc__base__common__functions.html#ga4397842181241a3494950c2802dce42f">Cy_DSADC_CountsTo_uVolts</a>. </td><td>Defect fix  </td></tr>
<tr>
<td>1.0 </td><td>Initial version </td><td></td></tr>
</table>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>CAT2 Peripheral Driver Library</b> by <b>Infineon Technologies</b>.
            All rights reserved.
        </li>
    </ul>
</div>
-->
</body>
</html>
