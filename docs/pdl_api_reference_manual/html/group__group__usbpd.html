<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CAT2 Peripheral Driver Library: USBPD        (USB Power Delivery)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CAT2 Peripheral Driver Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__group__usbpd.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">API Reference</a>  </div>
  <div class="headertitle">
<div class="title">USBPD (USB Power Delivery)</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">General Description</h2>
<p>The USBPD driver provides APIs to configure and access the M0S8-USBPD and MX-USBPD IP block on the EZ-PD PMG1 family of devices into a high-quality, versatile analog front-end for PD applications. </p>
<p>The PMG1 family is a set of USB Power-Delivery (USBPD) enabled Micro-Controllers for the general market. The devices in this family support one or two instances of the Power Delivery Sub-System (PDSS) in addition to other standard MCU peripherals available on PSoC4 devices.</p>
<div class="image">
<img src="usbpd_driver.png" alt="usbpd_driver.png"/>
<div class="caption">
USBPD Driver Solution</div></div>
<p>The USBPD driver interacts directly with the hardware and provides support of the features available in the hardware. It implements the API interface and callbacks/hooks requested by the PDStack middleware to operate.</p>
<p>The functions of the USBPD driver include</p><ol type="1">
<li>Configure the terminations on the CC pins of the PMG1 device, including support for automatic Rp-Rd toggle on parts that support Dual Role Port (DRP) functionality.</li>
<li>Determine the external terminations applied on the CC pins using the line comparators.</li>
<li>Measure Type-C VBus voltage using the 8-bit ADC.</li>
<li>Configure the USB-PD Transceiver (PHY) and send/receive messages, including support for Extended Data Messages.</li>
<li>Configure the gate driver outputs of the PMG1 device to enable power output or charging paths.</li>
<li>Configure the comparators and cut-off circuits to provide Over-Voltage (OV), Under-Voltage (UV), Over-Current (OC), Short-Circuit (SC) and Reverse-Current (RC) Protection.</li>
<li>Configure the in-built USB 2.0 and Side Band Use (SBU) Multiplexers for USB, Display and Thunderbolt data connections.</li>
<li>Drive/detect transitions on the HotPlug Detect (HPD) pin as required by the Display function.</li>
<li>Configure the terminations and measure the voltages on the D+/D- pins for BC 1.2. Most of the USBPD driver functions are not intended to be called directly from the user application as the PDStack middleware makes use of them to manage the functionality in a specification compliant manner.</li>
</ol>
<h1><a class="anchor" id="group_usbpd_section_configuration"></a>
Configuration Considerations</h1>
<h2><a class="anchor" id="group_usbpd_section_configuration_personalities"></a>
Use ModusToolbox Device Configurator Tool to generate initialization code</h2>
<p>The following are the steps to generate initialization code using the ModusToolbox Device Configurator Tool:</p><ol type="1">
<li>Launch the ModusToolbox Device Configurator Tool</li>
<li>Switch to the Peripherals tab. Enable the USB-C Power Delivery personality under Communication</li>
<li>Go to the Parameters Pane for the USBPD Personality and configure it with the desired parameters (Configure the clock inputs, set the fault protection parameters per configuration considerations, etc) <div class="image">
<img src="usbpd_driver_clocks.png" alt="usbpd_driver_clocks.png"/>
<div class="caption">
USBPD Driver Clock Configuration</div></div>
  <div class="image">
<img src="usbpd_driver_fault_protection.png" alt="usbpd_driver_fault_protection.png"/>
<div class="caption">
USBPD Driver Fault Protection Configuration</div></div>
 </li>
<li>Perform File-&gt;Save for the initialization code to generate</li>
</ol>
<p>Now, all required USBPD driver initialization code and configuration prerequisites will be generated:</p>
<ol type="1">
<li>The Peripheral Clock Divider assignment and analog routing are parts of the init_cycfg_all() routine. Place the call of cybsp_init () function before using any USBPD driver API functions to ensure initialization of all external resources required for the USBPD driver operation.</li>
<li>The USBPD driver configuration structure declaration is in the cycfg_peripherals.h file and its initialization is in the cycfg_peripherals.c file. The variable name is mtb_usbpd_port&lt;port_num&gt;_config. It must be used with <a class="el" href="group__group__usbpd__typec__functions.html#ga9882cd335076678ab7564e92fee29b75" title="This function initializes the PDSS IP with necessary clock and interrupt handlers. ">Cy_USBPD_Init()</a> function. <div class="fragment"><div class="line"><a class="code" href="structcy__stc__fault__vbus__ovp__cfg__t.html">cy_stc_fault_vbus_ovp_cfg_t</a> mtb_usbpd_port0_ovp_config = </div><div class="line">{</div><div class="line">    .<a class="code" href="structcy__stc__fault__vbus__ovp__cfg__t.html#a5b28f7cbb0492a728a065d1262af6b5c">enable</a> = <span class="keyword">true</span>,</div><div class="line">    .mode = 2,</div><div class="line">    .threshold = 20,</div><div class="line">    .debounce = 10,</div><div class="line">    .retryCount = 2,</div><div class="line">};</div><div class="line"></div><div class="line"><a class="code" href="structcy__stc__fault__vbus__uvp__cfg__t.html">cy_stc_fault_vbus_uvp_cfg_t</a> mtb_usbpd_port0_uvp_config = </div><div class="line">{</div><div class="line">    .<a class="code" href="structcy__stc__fault__vbus__uvp__cfg__t.html#affbad82d6d4b663f0543c6249028a15e">enable</a> = <span class="keyword">true</span>,</div><div class="line">    .mode = 2,</div><div class="line">    .threshold = 20,</div><div class="line">    .debounce = 10,</div><div class="line">    .retryCount = 2,</div><div class="line">};</div><div class="line"></div><div class="line"><a class="code" href="structcy__stc__usbpd__config__t.html">cy_stc_usbpd_config_t</a> mtb_usbpd_port0_config = </div><div class="line">{</div><div class="line">    .<a class="code" href="structcy__stc__usbpd__config__t.html#ae51855c6bbea9934f761b5f8a1595f99">vbusOvpConfig</a> = &amp;mtb_usbpd_port0_ovp_config,</div><div class="line">    .vbusUvpConfig = &amp;mtb_usbpd_port0_uvp_config,</div><div class="line">    .vbusOcpConfig = NULL,</div><div class="line">    .vbusScpConfig = NULL,</div><div class="line">    .vbusRcpConfig = NULL,</div><div class="line">    .vconnOcpConfig = NULL,</div><div class="line">    .ccOvpConfig = NULL,</div><div class="line">    .sbuOvpConfig = NULL,</div><div class="line">    .legacyChargingConfig = NULL,</div><div class="line">};</div></div><!-- fragment --> <div class="fragment"><div class="line">        <span class="comment">/* Initialize the USBPD driver */</span></div><div class="line">        (void)<a class="code" href="group__group__usbpd__typec__functions.html#ga9882cd335076678ab7564e92fee29b75">Cy_USBPD_Init</a>(&amp;usbpdCtxt, 0, base, trimsBase, &amp;mtb_usbpd_port0_config, cy_pd_dpm_get_config);</div></div><!-- fragment --> </li>
</ol>
<h1><a class="anchor" id="group_usbpd_section_more_information"></a>
More Information</h1>
<p>For more information on the USBPD peripheral, refer to the technical reference manual (TRM) and the Datasheet.</p>
<h1><a class="anchor" id="group_usbpd_changelog"></a>
Changelog</h1>
<table class="doxtable">
<tr>
<th>Version</th><th>Changes</th><th>Reason for Change </th></tr>
<tr>
<td rowspan="3">2.40 </td><td>Added LF Counter driver. </td><td>New feature support.  </td></tr>
<tr>
<td>Updated configuration table space to support CCG8 device series. </td><td>Feature support.  </td></tr>
<tr>
<td>Corrected the ADC detach detection input used in PMG1-S1 device. </td><td>Defect Fix.  </td></tr>
<tr>
<td rowspan="3">2.30 </td><td>Use WLC1 Series Code compile directive </td><td>Defect Fix  </td></tr>
<tr>
<td>Changed from Cy_USBPD_Bch_Set_AfcTxData to Cy_USBPD_Bch_Afc_Set_Tx_Data </td><td>API Name Change  </td></tr>
<tr>
<td>Added Cy_USBPD_Bch_AfcGetRxDataPtr and Cy_USBPD_Bch_AfcGetRxDataCount functions </td><td>APIs added for Adaptive fast charge feature(AFC)  </td></tr>
<tr>
<td rowspan="4">2.20 </td><td>Added support for PMG1B1 device. </td><td>New device support.  </td></tr>
<tr>
<td>Added API to measure Vbus current. </td><td>New feature support.  </td></tr>
<tr>
<td>Vsys-Vbus switch issue fixed. </td><td>Defect Fix  </td></tr>
<tr>
<td>Fixed deep sleep reference not enabled during Type-C restart. </td><td>Defect Fix  </td></tr>
<tr>
<td rowspan="1">2.10 </td><td>CCG7D updates. </td><td>Feature support.  </td></tr>
<tr>
<td rowspan="2">2.0 </td><td>Added support for CCG7D, CCG7s and WLC1 devices. </td><td>New device support.  </td></tr>
<tr>
<td>Added support for PPS source and regulation control via internal error amplifier </td><td>New feature support  </td></tr>
<tr>
<td rowspan="3">1.30 </td><td>Added SBU Level Detection </td><td>New feature support.  </td></tr>
<tr>
<td>Updates for EPR support </td><td>New feature support  </td></tr>
<tr>
<td>Added legacy charging drivers </td><td>New feature support  </td></tr>
<tr>
<td>1.20.1 </td><td>Update the paths to the code snippets. </td><td>PDL structure update.  </td></tr>
<tr>
<td>1.20 </td><td>Added APIs to control NGDO drive strength. </td><td>New feature support  </td></tr>
<tr>
<td rowspan="3">1.10 </td><td>Added drivers for HPD and MUX feature.  </td><td>New feature support.  </td></tr>
<tr>
<td>Added support for VBus Over Current Protection, VBus Short Circuit Protection, VBus Reverse Current Protection and VConn Over Current Protection.  </td><td>New feature support.  </td></tr>
<tr>
<td>Added support for PMG1S3 device.  </td><td>New device support.  </td></tr>
<tr>
<td>1.0 </td><td>Initial version </td><td></td></tr>
</table>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
API Reference</h2></td></tr>
<tr class="memitem:group__group__usbpd__common"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__usbpd__common.html">Common</a></td></tr>
<tr class="memdesc:group__group__usbpd__common"><td class="mdescLeft">&#160;</td><td class="mdescRight">USBPD driver common data structures. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__usbpd__hpd"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__usbpd__hpd.html">HPD (USBPD)</a></td></tr>
<tr class="memdesc:group__group__usbpd__hpd"><td class="mdescLeft">&#160;</td><td class="mdescRight">USBPD Hot-Plug Detect driver. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__usbpd__legacy"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__usbpd__legacy.html">Legacy Charging (USBPD)</a></td></tr>
<tr class="memdesc:group__group__usbpd__legacy"><td class="mdescLeft">&#160;</td><td class="mdescRight">USBPD Legacy Charging driver. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__usbpd__mux"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__usbpd__mux.html">MUX (USBPD)</a></td></tr>
<tr class="memdesc:group__group__usbpd__mux"><td class="mdescLeft">&#160;</td><td class="mdescRight">USBPD MUX Control driver. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__usbpd__phy"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__usbpd__phy.html">Phy (USBPD)</a></td></tr>
<tr class="memdesc:group__group__usbpd__phy"><td class="mdescLeft">&#160;</td><td class="mdescRight">USBPD Phy transceiver driver. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__usbpd__typec"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__usbpd__typec.html">Type C (USBPD)</a></td></tr>
<tr class="memdesc:group__group__usbpd__typec"><td class="mdescLeft">&#160;</td><td class="mdescRight">USBPD Type C driver. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__usbpd__vbus__ctrl"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__usbpd__vbus__ctrl.html">VBus Ctrl (USBPD)</a></td></tr>
<tr class="memdesc:group__group__usbpd__vbus__ctrl"><td class="mdescLeft">&#160;</td><td class="mdescRight">USBPD VBus Control driver. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__usbpd__idac__ctrl"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__usbpd__idac__ctrl.html">IDAC (USBPD)</a></td></tr>
<tr class="memdesc:group__group__usbpd__idac__ctrl"><td class="mdescLeft">&#160;</td><td class="mdescRight">USBPD IDAC Control driver. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__usbpd__buck__boost"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__usbpd__buck__boost.html">Buck Boost (USBPD)</a></td></tr>
<tr class="memdesc:group__group__usbpd__buck__boost"><td class="mdescLeft">&#160;</td><td class="mdescRight">USBPD VBus Buck Boost driver. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__usbpd__lf__counter"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__usbpd__lf__counter.html">LF Counter (USBPD)</a></td></tr>
<tr class="memdesc:group__group__usbpd__lf__counter"><td class="mdescLeft">&#160;</td><td class="mdescRight">USBPD LF Counter driver. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>CAT2 Peripheral Driver Library</b> by <b>Infineon Technologies</b>.
            All rights reserved.
        </li>
    </ul>
</div>
-->
</body>
</html>
