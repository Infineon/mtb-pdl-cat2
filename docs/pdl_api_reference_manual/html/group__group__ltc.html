<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CAT2 Peripheral Driver Library: LTC          (Lifetime Counter)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CAT2 Peripheral Driver Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__group__ltc.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Modules</a>  </div>
  <div class="headertitle">
<div class="title">LTC (Lifetime Counter)</div>  </div>
</div><!--header-->
<div class="contents">

<p>Provides a basic 32-bit lifetime counter with a prescaler (/2 to /32).  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:group__group__ltc__macros"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__ltc__macros.html">Macros</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__ltc__enums"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__ltc__enums.html">Enumerated Types</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__ltc__functions"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__ltc__functions.html">Functions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Provides a basic 32-bit lifetime counter with a prescaler (/2 to /32). </p>
<dl class="section note"><dt>Note</dt><dd>Supported on PSOC4 HVMS/PA.</dd></dl>
<p>The functions and other declarations used in this driver are in cy_ltc.h. You can include cy_pdl.h to get access to all functions and declarations in the PDL.</p>
<p>Provides a basic 32-bit up-counter operation in the DeepSleep domain at a frequency lower than <a class="el" href="group__group__sysclk__lf.html">Low-Frequency Clock</a>, which can provide a Deep Sleep interrupt when set by FW (match WAKEUP value) or a regular lifetime counter without an interrupt. With the prescaler, the net resolution of the counter becomes 37-bit causing an overflow every 49.7 days. The counter will continue counting upon overflow.</p>
<p>The lifetime counter shall survive all resets except POR/XRES/BOD.</p>
<p><b> Clock Source </b></p>
<div class="image">
<img src="ltc_irq.png" alt="ltc_irq.png"/>
<div class="caption">
LTC Solution</div></div>
<p>The lifetime counter operates on <a class="el" href="group__group__sysclk__lf.html">Low-Frequency Clock</a>. The <a class="el" href="group__group__sysclk__lf.html">Low-Frequency Clock</a> release depends on the startup time of the clock. Any AHB writes before <a class="el" href="group__group__sysclk__lf.html">Low-Frequency Clock</a> is released will be not pass through to the actual lifetime counter configuration until the <a class="el" href="group__group__sysclk__lf.html">Low-Frequency Clock</a> starts. If there is a system reset before the synchronization takes place, the values will be reset, and FW will have to write the configuration again. FW can read the counter value to make sure the counter has started.</p>
<p>The lifetime counter includes a prescaler and is triggered from the <a class="el" href="group__group__sysclk__lf.html">Low-Frequency Clock</a> clock. The prescaler provides the <a class="el" href="group__group__sysclk__lf.html">Low-Frequency Clock</a> from divide-by-2 up to divide-by-32.</p>
<p>The 32-bit counter runs off of the pre-scaled clock. It is capable of wrapping. The initial value is intended to provide a life-cycle count maintained by software. The value is expected to be loaded after POR by software, and software periodically updates flash to the current count.</p>
<p><b> Application </b></p><ul>
<li>a) The customer wants to know how long the battery has been connected (the same battery that powers our part). The lifetime counter and periodic writes are combined to NV memory. The lifetime counter is up to every 49.7 days of the roll over, which is used to calculate the total time the battery is connected. <br />
</li>
<li>b) After manufacturing, some devices are frequently put on a ship, and it can take months to arrive at the destination. When they arrive, the battery is expected to be still in the ready state. It would be better to keep track of actual Lifetime in this mode. In that case, we need to keep PILO and Lifetime counter running, disable WDT, CRWDT, and disable Lifetime wake-up.</li>
</ul>
<p><b> Power Modes </b></p>
<p>The "WAKEUP" value is compared against the hardware "COUNT" value. If there is a match, a Deep Sleep interrupt occurs.</p>
<p>User does NOT need to wait for enable synchronization before entering deepsleep. This will occur within one <a class="el" href="group__group__sysclk__lf.html">Low-Frequency Clock</a> cycle. But it is recommended to wait for the enabled status ( <a class="el" href="group__group__ltc__functions.html#ga5c7f0a02f7eba564927f37b237f89a81">Cy_LTC_IsEnabled</a> ) before entering Deep Sleep.</p>
<h1><a class="anchor" id="group_rtc_section_configuration"></a>
Configuration Considerations</h1>
<p>Before using the <a class="el" href="group__group__ltc__functions.html#ga0b8a969b430b6e331db30a88c8ca12dc">Cy_LTC_SetDivider</a> or <a class="el" href="group__group__ltc__functions.html#gad3a85e65589e51faa248204bc57ea136">Cy_LTC_SetCounterValue</a> function, disable the lifetime counter by the <a class="el" href="group__group__ltc__functions.html#ga5e22abb6a388207decb1d5674b93561a">Cy_LTC_Disable</a> function.</p>
<p>FW shall wait for the counter disabled synchronization before re-enabling the lifetime counter to ensure that the synchronization is completed. The user can read <a class="el" href="group__group__ltc__functions.html#ga5c7f0a02f7eba564927f37b237f89a81">Cy_LTC_IsEnabled</a> to check that the lifetime counter is disabled.</p>
<dl class="section note"><dt>Note</dt><dd>The user can change the WAKEUP value without disabling the lifetime counter</dd></dl>
<p>For example: </p><div class="fragment"><div class="line">    <span class="comment">/* The Watchdog timer should be unlocked before ILO being enabled. */</span></div><div class="line">    <a class="code" href="group__group__wdt__functions.html#ga0c4e41c9c1b0d575747d1a984e63a6b0">Cy_WDT_Unlock</a>();</div><div class="line"></div><div class="line">    <span class="comment">/* A Low frequency clock source should be enabled before this driver usage. */</span></div><div class="line">    <a class="code" href="group__group__sysclk__ilo__funcs.html#gaabb2612adc103562da7d6dc451a33caa">Cy_SysClk_IloEnable</a>();</div><div class="line"></div><div class="line">    <span class="comment">/* Initialize the lifetime counter driver */</span></div><div class="line">    <a class="code" href="group__group__ltc__functions.html#ga7768c1ea4b939662aa8527285719d752">Cy_LTC_Init</a>();</div><div class="line"></div><div class="line">    <span class="comment">/* Disable lifetime counter. */</span></div><div class="line">    <a class="code" href="group__group__ltc__functions.html#ga5e22abb6a388207decb1d5674b93561a">Cy_LTC_Disable</a>();</div><div class="line"></div><div class="line">    <span class="comment">/* Configure custom divider ratio for preselector. */</span></div><div class="line">    <a class="code" href="group__group__ltc__functions.html#ga0b8a969b430b6e331db30a88c8ca12dc">Cy_LTC_SetDivider</a>(<a class="code" href="group__group__ltc__enums.html#ggabdf07ca0998b0e52eb70a813303ce4bfa537b0fd4103101e0c5316c7eafdd9676">CY_LTC_PRESEL_DIV_4</a>);</div><div class="line"></div><div class="line">    <span class="comment">/* Reset Counter value */</span></div><div class="line">    <a class="code" href="group__group__ltc__functions.html#gad3a85e65589e51faa248204bc57ea136">Cy_LTC_SetCounterValue</a>(0);</div><div class="line"></div><div class="line">    <span class="comment">/* Set 1000 ticks */</span></div><div class="line">    <a class="code" href="group__group__ltc__functions.html#ga58c72c6230beb64afb95b6bd5e24192f">Cy_LTC_SetWakeup</a>(1000);</div><div class="line"></div><div class="line">    <span class="comment">/* Due to internal synchronization, it takes about one LFCLK cycle</span></div><div class="line"><span class="comment">    to update the counters after divider configuration. */</span></div><div class="line">    uint16_t delay = (uint16_t) (1000000UL / <a class="code" href="group__group__sysclk__clk__lf__funcs.html#ga7fef4f956bb23bd5e7f332bd4e8b7625">Cy_SysClk_ClkLfGetFrequency</a>());</div><div class="line">    <span class="comment">/* Wait for LTC counter value changing. */</span></div><div class="line">    <a class="code" href="group__group__syslib__functions.html#ga9d2ffe4829c636ad78eaae5043fd6ae6">Cy_SysLib_DelayUs</a>(delay);</div><div class="line">    </div><div class="line">    <span class="comment">/* Enable lifetime counter. */</span></div><div class="line">    <a class="code" href="group__group__ltc__functions.html#ga203bfc615946c0e8db7dd5b02a05fcdf">Cy_LTC_Enable</a>();</div><div class="line"></div><div class="line">    <span class="comment">/* User can update the wakeup value without disabling the lifetime counter. */</span></div><div class="line">    <a class="code" href="group__group__ltc__functions.html#ga58c72c6230beb64afb95b6bd5e24192f">Cy_LTC_SetWakeup</a>(2000);</div><div class="line"></div><div class="line">    <span class="comment">/* It is recommended to wait for status enabled before entering deepsleep. */</span></div><div class="line">    <span class="keywordflow">while</span>(!<a class="code" href="group__group__ltc__functions.html#ga5c7f0a02f7eba564927f37b237f89a81">Cy_LTC_IsEnabled</a>())</div><div class="line">    {</div><div class="line">        <a class="code" href="group__group__syslib__functions.html#gaad1c32546fdb0e3c6fa8b46fb95843b5">Cy_SysLib_Delay</a>(1UL);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/* Put the device into Deep Sleep mode and wait for an interrupt to wake up. */</span></div><div class="line">    <a class="code" href="group__group__syspm__functions__power.html#gae24d1a7d457b5355858651a213c2f4cd">Cy_SysPm_CpuEnterDeepSleep</a>();</div><div class="line"></div><div class="line">    <span class="comment">/* The wakeup value is compared against the hardware COUNT value.</span></div><div class="line"><span class="comment">    If there is a match will deepsleep interrupt occur. */</span></div><div class="line">    </div></div><!-- fragment --> <h1><a class="anchor" id="group_ltc_section_more_information"></a>
More Information</h1>
<p>For more information on the LTC peripheral, refer to the technical reference manual (TRM).</p>
<h1><a class="anchor" id="group_ltc_changelog"></a>
Changelog</h1>
<table class="doxtable">
<tr>
<th>Version</th><th>Changes</th><th>Reason for Change </th></tr>
<tr>
<td>1.0 </td><td>Initial version </td><td></td></tr>
</table>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>CAT2 Peripheral Driver Library</b> by <b>Infineon Technologies</b>.
            All rights reserved.
        </li>
    </ul>
</div>
-->
</body>
</html>
