<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CAT2 Peripheral Driver Library: Startup      (System Configuration Files)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CAT2 Peripheral Driver Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__group__system__config.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">API Reference</a>  </div>
  <div class="headertitle">
<div class="title">Startup (System Configuration Files)</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">General Description</h2>
<p>Provides device startup, system configuration, and linker script files. </p>
<p>The system startup provides the followings features:</p><ul>
<li><a class="el" href="group__group__system__config.html#group_system_config_device_memory_definition">Device Memory Definition</a></li>
<li><a class="el" href="group__group__system__config.html#group_system_config_device_initialization">Device Initialization</a></li>
<li><a class="el" href="group__group__system__config.html#group_system_config_heap_stack_config">Heap and Stack Configuration</a></li>
<li><a class="el" href="group__group__system__config.html#group_system_config_default_handlers">Default Interrupt Handlers Definition</a></li>
<li><a class="el" href="group__group__system__config.html#group_system_config_device_vector_table">Vectors Table Copy from Flash to RAM</a></li>
</ul>
<h1><a class="anchor" id="group_system_config_configuration"></a>
Configuration Considerations</h1>
<h2><a class="anchor" id="group_system_config_device_memory_definition"></a>
Device Memory Definition</h2>
<p>The flash and RAM allocation is defined by the linker scripts.</p>
<dl class="section note"><dt>Note</dt><dd>The linker files provided with the PDL are generic and handle all common use cases. Your project may not use every section defined in the linker files. In that case you may see warnings during the build process. To eliminate build warnings in your project, you can simply comment out or remove the relevant code in the linker file.</dd></dl>
<p><b>ARM GCC</b><br />
 The flash and RAM sections for the CPU are defined in the linker file: for example, 'cy8c4xx5.ld'.</p>
<p>Change the flash and RAM sizes by editing the macros value in the linker file: </p><div class="fragment"><div class="line">__FLASH_START = 0x00000000;</div><div class="line">__FLASH_SIZE =  0x00008000;</div><div class="line"></div><div class="line">__RAM_START = 0x20000000;</div><div class="line">__RAM_SIZE =  0x00001000;</div></div><!-- fragment --><p><b>ARM MDK</b><br />
 The flash and RAM sections for the CPU are defined in the linker file: for example, 'cy8c4xx5.sct'.</p>
<dl class="section note"><dt>Note</dt><dd>The linker files provided with the PDL are generic and handle all common use cases. Your project may not use every section defined in the linker file. In that case you may see the warnings during the build process: L6314W (no section matches pattern) and/or L6329W (pattern only matches removed unused sections). In your project, you can suppress the warning by passing the "--diag_suppress=L6314W,L6329W" option to the linker. You can also comment out or remove the relevant code in the linker file.</dd></dl>
<p>Change the flash and RAM sizes by editing the macros value in the linker file: </p><div class="fragment"><div class="line"><span class="preprocessor">#define __FLASH_START  0x00000000</span></div><div class="line"><span class="preprocessor">#define __FLASH_SIZE   0x00008000</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define __RAM_START    0x20000000</span></div><div class="line"><span class="preprocessor">#define __RAM_SIZE     0x00001000</span></div></div><!-- fragment --><p><b>IAR</b><br />
 The flash and RAM sections for the CPU are defined in the linker files: for example, 'cy8c4xx5.icf'.</p>
<p>Change the flash and RAM sizes by editing the macros value in the linker file: </p><div class="fragment"><div class="line">define symbol __ICFEDIT_region_IROM1_start__ = 0x00000000;</div><div class="line">define symbol __ICFEDIT_region_IROM1_end__   = 0x00007FFF;</div><div class="line"></div><div class="line">define symbol __ICFEDIT_region_IRAM1_start__ = 0x20000000;</div><div class="line">define symbol __ICFEDIT_region_IRAM1_end__   = 0x20000FFF;</div></div><!-- fragment --><h2><a class="anchor" id="group_system_config_device_initialization"></a>
Device Initialization</h2>
<p>After a power-on-reset (POR), the boot process is handled by the boot code from the on-chip ROM that is always executed by the core. The boot code passes the control to the startup code located in flash.</p>
<p>The startup code performs the device initialization by a call to Reset_Handler(), which calls <a class="el" href="group__group__system__config__system__functions.html#ga93f514700ccf00d08dbdcff7f1224eb2" title="Initializes the system: disables the WDT, disables the interrupts and calls the Cy_SystemInit() funct...">SystemInit()</a>, and then calls the CMSIS-defined __PROGRAM_START().</p>
<h2><a class="anchor" id="group_system_config_heap_stack_config"></a>
Heap and Stack Configuration</h2>
<p>The heap and stack configurations are defined by the linker scripts.</p>
<p>By default, the stack size is set to 0x0000400 and the heap size is allocated dynamically to the whole available free memory up to stack memory and it is set to the 0x00000080 (for ARM GCC and IAR compilers) as minimal value.</p>
<p>Change the stack size by editing the macro value in the linker file: <b>ARM GCC</b><br />
</p><div class="fragment"><div class="line">__STACK_SIZE = 0x00000400;</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Correct operation of malloc and related functions depends on the working implementation of the 'sbrk' function. Newlib-nano (default C runtime library used by the GNU Arm Embedded toolchain) provides weak 'sbrk' implementation that doesn't check for heap and stack collisions during excessive memory allocations. To ensure the heap always remains within the range defined by __HeapBase and __HeapLimit linker symbols, provide a strong override for the 'sbrk' function: <div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> * _sbrk(uint32_t incr)</div><div class="line">{</div><div class="line">    <span class="keyword">extern</span> uint8_t __HeapBase, __HeapLimit;</div><div class="line">    <span class="keyword">static</span> uint8_t *heapBrk = &amp;__HeapBase;</div><div class="line">    uint8_t *prevBrk = heapBrk;</div><div class="line">    <span class="keywordflow">if</span> (incr &gt; (uint32_t)(&amp;__HeapLimit - heapBrk))</div><div class="line">    {</div><div class="line">        errno = ENOMEM;</div><div class="line">        <span class="keywordflow">return</span> (<span class="keywordtype">void</span> *)-1;</div><div class="line">    }</div><div class="line">    heapBrk += incr;</div><div class="line">    <span class="keywordflow">return</span> prevBrk;</div><div class="line">}</div></div><!-- fragment --> For FreeRTOS-enabled multi-threaded applications, it is sufficient to include clib-support library that provides newlib-compatible implementations of 'sbrk', '__malloc_lock' and '__malloc_unlock': <br />
 <a href="https://github.com/Infineon/clib-support">https://github.com/Infineon/clib-support</a>.</dd></dl>
<p><b>ARM MDK</b><br />
</p><div class="fragment"><div class="line"><span class="preprocessor">#define __STACK_SIZE       0x00000400</span></div></div><!-- fragment --><p> <b>IAR</b><br />
</p><div class="fragment"><div class="line">define symbol __ICFEDIT_size_cstack__ = 0x0400;</div></div><!-- fragment --><h2><a class="anchor" id="group_system_config_default_handlers"></a>
Default Interrupt Handlers Definition</h2>
<p>The default interrupt handler functions are defined as weak functions to a dummy handler in the startup file. The naming convention for the interrupt handler names is &lt;interrupt_name&gt;_IRQHandler. A default interrupt handler can be overwritten in user code by defining the handler function using the same name. For example: </p><div class="fragment"><div class="line"> <span class="keywordtype">void</span> scb_0_interrupt_IRQHandler(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    ...</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="group_system_config_device_vector_table"></a>
Vectors Table Copy from Flash to RAM</h2>
<p>This process uses memory sections defined in the linker script. The vector table address (and the vector table itself) is defined in the startup files (e.g. startup_psoc4100sp.c). The code in these files defines the Reset_Handler, represents __VECTOR_TABLE as vector table in Flash and __RAM_VECTOR_TABLE represents this table in RAM. <br />
 The vector table is copied from Flash to RAM in Reset_Handler using memcpy(). </p><div class="fragment"><div class="line">memcpy(__RAM_VECTOR_TABLE, __VECTOR_TABLE, CY_VECTOR_TABLE_SIZE_BYTES);</div></div><!-- fragment --><h1><a class="anchor" id="group_system_config_changelog"></a>
Changelog</h1>
<table class="doxtable">
<tr>
<th>Version</th><th>Changes</th><th>Reason for Change </th></tr>
<tr>
<td>2.0 </td><td>Removed unused extern cy_delayFreqHz. </td><td>PDL major revision.  </td></tr>
<tr>
<td>1.10.2 </td><td>Update the paths to the code snippets. </td><td>PDL structure update.  </td></tr>
<tr>
<td rowspan="2">1.10.1 </td><td>Added support for PMG1S0, PMG1S1, PMG1S2, PMG1S3 devices. </td><td>New device support.  </td></tr>
<tr>
<td>Added missing __ICFEDIT_region symbols to the IAR linker scripts. </td><td>Improve ICF editor support.  </td></tr>
<tr>
<td rowspan="5">1.10 </td><td>Updated Reset_Handler() for Cortex-M0 devices. </td><td rowspan="5">Implementation and documentation enhancements.  </td></tr>
<tr>
<td>Updated Reset_Handler() with IAR compiler support.  </td></tr>
<tr>
<td>Added low-level initialization routine for the RTOS-enabled applications.  </td></tr>
<tr>
<td>Updated system header with the vector table allocation.  </td></tr>
<tr>
<td>Set default system core clock frequency to 24 MHz.  </td></tr>
<tr>
<td>1.0 </td><td>Initial version </td><td></td></tr>
</table>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
API Reference</h2></td></tr>
<tr class="memitem:group__group__system__config__system__functions"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__system__config__system__functions.html">Functions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__system__config__globals"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__system__config__globals.html">Global Variables</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>CAT2 Peripheral Driver Library</b> by <b>Infineon Technologies</b>.
            All rights reserved.
        </li>
    </ul>
</div>
-->
</body>
</html>
